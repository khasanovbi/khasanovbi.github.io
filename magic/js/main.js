(()=>{var t,e,i={5786:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=v;var o=i(1689),n=i(2133),r=i(5890),a=i(1146),m=i(9540),h=i(8804),c=i(8558),_=i(830),l=i(7501),u=i(7176),p=(i(7998),v.STATIC="static"),d=v.KINEMATIC="kinematic",y=v.DYNAMIC="dynamic",f={type:p,position:r.zero(),angle:0,linearVelocity:r.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function v(t,e){e=n(e,f),s&&o.assert(r.isValid(e.position)),s&&o.assert(r.isValid(e.linearVelocity)),s&&o.assert(m.isFinite(e.angle)),s&&o.assert(m.isFinite(e.angularVelocity)),s&&o.assert(m.isFinite(e.angularDamping)&&e.angularDamping>=0),s&&o.assert(m.isFinite(e.linearDamping)&&e.linearDamping>=0),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==y?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=c.identity(),this.m_xf.p=r.clone(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new h,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new _,this.c_position=new l,this.m_force=r.zero(),this.m_torque=0,this.m_linearVelocity=r.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}function x(){this.mass=0,this.center=r.zero(),this.I=0}v.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},v._deserialize=function(t,e,i){var s=new v(e,t);if(t.fixtures)for(var o=t.fixtures.length-1;o>=0;o--){var n=i(u,t.fixtures[o],s);s._addFixture(n)}return s},v.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},v.prototype.getWorld=function(){return this.m_world},v.prototype.getNext=function(){return this.m_next},v.prototype.setUserData=function(t){this.m_userData=t},v.prototype.getUserData=function(){return this.m_userData},v.prototype.getFixtureList=function(){return this.m_fixtureList},v.prototype.getJointList=function(){return this.m_jointList},v.prototype.getContactList=function(){return this.m_contactList},v.prototype.isStatic=function(){return this.m_type==p},v.prototype.isDynamic=function(){return this.m_type==y},v.prototype.isKinematic=function(){return this.m_type==d},v.prototype.setStatic=function(){return this.setType(p),this},v.prototype.setDynamic=function(){return this.setType(y),this},v.prototype.setKinematic=function(){return this.setType(d),this},v.prototype.getType=function(){return this.m_type},v.prototype.setType=function(t){if(s&&o.assert(t===p||t===d||t===y),s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==p&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var n=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)for(var a=r.m_proxyCount,m=0;m<a;++m)n.touchProxy(r.m_proxies[m].proxyId)}},v.prototype.isBullet=function(){return this.m_bulletFlag},v.prototype.setBullet=function(t){this.m_bulletFlag=!!t},v.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},v.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},v.prototype.isAwake=function(){return this.m_awakeFlag},v.prototype.setAwake=function(t){t?0==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},v.prototype.isActive=function(){return this.m_activeFlag},v.prototype.setActive=function(t){if(s&&o.assert(0==this.isWorldLocked()),t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag)for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);else{for(e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var n=this.m_contactList;n;){var r=n;n=n.next,this.m_world.destroyContact(r.contact)}this.m_contactList=null}},v.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},v.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},v.prototype.getTransform=function(){return this.m_xf},v.prototype.setTransform=function(t,e){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){this.m_xf.set(t,e),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.synchronize(i,this.m_xf,this.m_xf)}},v.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},v.prototype.synchronizeFixtures=function(){var t=c.identity();this.m_sweep.getTransform(t,0);for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.synchronize(e,t,this.m_xf)},v.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},v.prototype.getPosition=function(){return this.m_xf.p},v.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},v.prototype.getAngle=function(){return this.m_sweep.a},v.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},v.prototype.getWorldCenter=function(){return this.m_sweep.c},v.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},v.prototype.getLinearVelocity=function(){return this.m_linearVelocity},v.prototype.getLinearVelocityFromWorldPoint=function(t){var e=r.sub(t,this.m_sweep.c);return r.add(this.m_linearVelocity,r.cross(this.m_angularVelocity,e))},v.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},v.prototype.setLinearVelocity=function(t){this.m_type!=p&&(r.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.set(t))},v.prototype.getAngularVelocity=function(){return this.m_angularVelocity},v.prototype.setAngularVelocity=function(t){this.m_type!=p&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},v.prototype.getLinearDamping=function(){return this.m_linearDamping},v.prototype.setLinearDamping=function(t){this.m_linearDamping=t},v.prototype.getAngularDamping=function(){return this.m_angularDamping},v.prototype.setAngularDamping=function(t){this.m_angularDamping=t},v.prototype.getGravityScale=function(){return this.m_gravityScale},v.prototype.setGravityScale=function(t){this.m_gravityScale=t},v.prototype.getMass=function(){return this.m_mass},v.prototype.getInertia=function(){return this.m_I+this.m_mass*r.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},v.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.set(this.m_sweep.localCenter)},v.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic())return this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);s&&o.assert(this.isDynamic());for(var t=r.zero(),e=this.m_fixtureList;e;e=e.m_next)if(0!=e.m_density){var i=new x;e.getMassData(i),this.m_mass+=i.mass,t.addMul(i.mass,i.center),this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*r.dot(t,t),s&&o.assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(r.cross(this.m_angularVelocity,r.sub(this.m_sweep.c,n)))},v.prototype.setMassData=function(t){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type==y){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*r.dot(t.center,t.center),s&&o.assert(this.m_I>0),this.m_invI=1/this.m_I);var e=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(r.cross(this.m_angularVelocity,r.sub(this.m_sweep.c,e)))}},v.prototype.applyForce=function(t,e,i){this.m_type==y&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=r.cross(r.sub(e,this.m_sweep.c),t)))},v.prototype.applyForceToCenter=function(t,e){this.m_type==y&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},v.prototype.applyTorque=function(t,e){this.m_type==y&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},v.prototype.applyLinearImpulse=function(t,e,i){this.m_type==y&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*r.cross(r.sub(e,this.m_sweep.c),t)))},v.prototype.applyAngularImpulse=function(t,e){this.m_type==y&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},v.prototype.shouldCollide=function(t){if(this.m_type!=y&&t.m_type!=y)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},v.prototype._addFixture=function(t){if(s&&o.assert(0==this.isWorldLocked()),1==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},v.prototype.createFixture=function(t,e){if(s&&o.assert(0==this.isWorldLocked()),1==this.isWorldLocked())return null;var i=new u(this,t,e);return this._addFixture(i),i},v.prototype.destroyFixture=function(t){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){s&&o.assert(t.m_body==this);var e=!1;if(this.m_fixtureList===t)this.m_fixtureList=t.m_next,e=!0;else for(var i=this.m_fixtureList;null!=i;){if(i.m_next===t){i.m_next=t.m_next,e=!0;break}i=i.m_next}s&&o.assert(e);for(var n=this.m_contactList;n;){var r=n.contact;n=n.next;var a=r.getFixtureA(),m=r.getFixtureB();t!=a&&t!=m||this.m_world.destroyContact(r)}if(this.m_activeFlag){var h=this.m_world.m_broadPhase;t.destroyProxies(h)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},v.prototype.getWorldPoint=function(t){return c.mulVec2(this.m_xf,t)},v.prototype.getWorldVector=function(t){return a.mulVec2(this.m_xf.q,t)},v.prototype.getLocalPoint=function(t){return c.mulTVec2(this.m_xf,t)},v.prototype.getLocalVector=function(t){return a.mulTVec2(this.m_xf.q,t)}},5676:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(1689),n=i(9540),r=i(5890),a=i(8558),m=i(6514),h=i(1146),c=i(3883),_=i(5713),l=i(4735);function u(t){this.contact=t,this.prev,this.next,this.other}function p(t,e,i,s,o){this.m_nodeA=new u(this),this.m_nodeB=new u(this),this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=o,this.m_manifold=new _,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=y(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=f(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=r.zero(),this.v_normalMass=new m,this.v_K=new m,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=r.zero(),this.p_localPoint=r.zero(),this.p_localCenterA=r.zero(),this.p_localCenterB=r.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}function d(){this.rA=r.zero(),this.rB=r.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function y(t,e){return n.sqrt(t*e)}function f(t,e){return t>e?t:e}t.exports=p,p.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getShape(),a=i.getShape(),m=e.getBody(),h=i.getBody(),c=this.getManifold(),_=c.pointCount;s&&o.assert(_>0),this.v_invMassA=m.m_invMass,this.v_invMassB=h.m_invMass,this.v_invIA=m.m_invI,this.v_invIB=h.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=_,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=m.m_invMass,this.p_invMassB=h.m_invMass,this.p_invIA=m.m_invI,this.p_invIB=h.m_invI,this.p_localCenterA=r.clone(m.m_sweep.localCenter),this.p_localCenterB=r.clone(h.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=a.m_radius,this.p_type=c.type,this.p_localNormal=r.clone(c.localNormal),this.p_localPoint=r.clone(c.localPoint),this.p_pointCount=_;for(var l=0;l<_;++l){var u=c.points[l],p=this.v_points[l]=new d;t.warmStarting?(p.normalImpulse=t.dtRatio*u.normalImpulse,p.tangentImpulse=t.dtRatio*u.tangentImpulse):(p.normalImpulse=0,p.tangentImpulse=0),p.rA.setZero(),p.rB.setZero(),p.normalMass=0,p.tangentMass=0,p.velocityBias=0,this.p_localPoints[l]=r.clone(u.localPoint)}},p.prototype.getManifold=function(){return this.m_manifold},p.prototype.getWorldManifold=function(t){var e=this.m_fixtureA.getBody(),i=this.m_fixtureB.getBody(),s=this.m_fixtureA.getShape(),o=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,e.getTransform(),s.m_radius,i.getTransform(),o.m_radius)},p.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},p.prototype.isEnabled=function(){return this.m_enabledFlag},p.prototype.isTouching=function(){return this.m_touchingFlag},p.prototype.getNext=function(){return this.m_next},p.prototype.getFixtureA=function(){return this.m_fixtureA},p.prototype.getFixtureB=function(){return this.m_fixtureB},p.prototype.getChildIndexA=function(){return this.m_indexA},p.prototype.getChildIndexB=function(){return this.m_indexB},p.prototype.flagForFiltering=function(){this.m_filterFlag=!0},p.prototype.setFriction=function(t){this.m_friction=t},p.prototype.getFriction=function(){return this.m_friction},p.prototype.resetFriction=function(){this.m_friction=y(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},p.prototype.setRestitution=function(t){this.m_restitution=t},p.prototype.getRestitution=function(){return this.m_restitution},p.prototype.resetRestitution=function(){this.m_restitution=f(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},p.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},p.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},p.prototype.evaluate=function(t,e,i){this.m_evaluateFcn(t,e,this.m_fixtureA,this.m_indexA,i,this.m_fixtureB,this.m_indexB)},p.prototype.update=function(t){this.m_enabledFlag=!0;var e=!1,i=this.m_touchingFlag,s=this.m_fixtureA.isSensor(),o=this.m_fixtureB.isSensor(),n=s||o,r=this.m_fixtureA.getBody(),a=this.m_fixtureB.getBody(),m=r.getTransform(),h=a.getTransform();if(n){var c=this.m_fixtureA.getShape(),u=this.m_fixtureB.getShape();e=l.testOverlap(c,this.m_indexA,u,this.m_indexB,m,h),this.m_manifold.pointCount=0}else{var p=this.m_manifold;this.m_manifold=new _,this.evaluate(this.m_manifold,m,h),e=this.m_manifold.pointCount>0;for(var d=0;d<this.m_manifold.pointCount;++d){var y=this.m_manifold.points[d];y.normalImpulse=0,y.tangentImpulse=0;for(var f=0;f<p.pointCount;++f){var v=p.points[f];if(v.id.key==y.id.key){y.normalImpulse=v.normalImpulse,y.tangentImpulse=v.tangentImpulse;break}}}e!=i&&(r.setAwake(!0),a.setAwake(!0))}this.m_touchingFlag=e,0==i&&1==e&&t&&t.beginContact(this),1==i&&0==e&&t&&t.endContact(this),0==n&&e&&t&&t.preSolve(this,p)},p.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,!1)},p.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,!0,e,i)},p.prototype._solvePositionConstraint=function(t,e,i,s){var o=this.m_fixtureA,m=this.m_fixtureB,l=o.getBody(),u=m.getBody(),p=(l.c_velocity,u.c_velocity,l.c_position),d=u.c_position,y=r.clone(this.p_localCenterA),f=r.clone(this.p_localCenterB),v=0,x=0;e&&l!=i&&l!=s||(v=this.p_invMassA,x=this.p_invIA);var A=0,g=0;e&&u!=i&&u!=s||(A=this.p_invMassB,g=this.p_invIB);for(var b=r.clone(p.c),B=p.a,w=r.clone(d.c),S=d.a,C=0,M=0;M<this.p_pointCount;++M){var I,T,P,V=a.identity(),z=a.identity();switch(V.q.set(B),z.q.set(S),V.p=r.sub(b,h.mulVec2(V.q,y)),z.p=r.sub(w,h.mulVec2(z.q,f)),this.p_type){case _.e_circles:var E=a.mulVec2(V,this.p_localPoint),L=a.mulVec2(z,this.p_localPoints[0]);(I=r.sub(L,E)).normalize(),T=r.combine(.5,E,.5,L),P=r.dot(r.sub(L,E),I)-this.p_radiusA-this.p_radiusB;break;case _.e_faceA:I=h.mulVec2(V.q,this.p_localNormal);var q=a.mulVec2(V,this.p_localPoint),F=a.mulVec2(z,this.p_localPoints[M]);P=r.dot(r.sub(F,q),I)-this.p_radiusA-this.p_radiusB,T=F;break;case _.e_faceB:I=h.mulVec2(z.q,this.p_localNormal);q=a.mulVec2(z,this.p_localPoint),F=a.mulVec2(V,this.p_localPoints[M]);P=r.dot(r.sub(F,q),I)-this.p_radiusA-this.p_radiusB,T=F,I.mul(-1)}var D=r.sub(T,b),R=r.sub(T,w);C=n.min(C,P);var k=e?c.toiBaugarte:c.baumgarte,j=c.linearSlop,O=c.maxLinearCorrection,G=n.clamp(k*(P+j),-O,0),U=r.cross(D,I),Y=r.cross(R,I),N=v+A+x*U*U+g*Y*Y,W=N>0?-G/N:0,J=r.mul(W,I);b.subMul(v,J),B-=x*r.cross(D,J),w.addMul(A,J),S+=g*r.cross(R,J)}return p.c.set(b),p.a=B,d.c.set(w),d.a=S,C},p.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getBody(),m=i.getBody(),_=n.c_velocity,l=m.c_velocity,u=n.c_position,p=m.c_position,d=this.p_radiusA,y=this.p_radiusB,f=this.getManifold(),v=this.v_invMassA,x=this.v_invMassB,A=this.v_invIA,g=this.v_invIB,b=r.clone(this.p_localCenterA),B=r.clone(this.p_localCenterB),w=r.clone(u.c),S=u.a,C=r.clone(_.v),M=_.w,I=r.clone(p.c),T=p.a,P=r.clone(l.v),V=l.w;s&&o.assert(f.pointCount>0);var z=a.identity(),E=a.identity();z.q.set(S),E.q.set(T),z.p.setCombine(1,w,-1,h.mulVec2(z.q,b)),E.p.setCombine(1,I,-1,h.mulVec2(E.q,B));var L=f.getWorldManifold(null,z,d,E,y);this.v_normal.set(L.normal);for(var q=0;q<this.v_pointCount;++q){var F=this.v_points[q];F.rA.set(r.sub(L.points[q],w)),F.rB.set(r.sub(L.points[q],I));var D=r.cross(F.rA,this.v_normal),R=r.cross(F.rB,this.v_normal),k=v+x+A*D*D+g*R*R;F.normalMass=k>0?1/k:0;var j=r.cross(this.v_normal,1),O=r.cross(F.rA,j),G=r.cross(F.rB,j),U=v+x+A*O*O+g*G*G;F.tangentMass=U>0?1/U:0,F.velocityBias=0;var Y=r.dot(this.v_normal,P)+r.dot(this.v_normal,r.cross(V,F.rB))-r.dot(this.v_normal,C)-r.dot(this.v_normal,r.cross(M,F.rA));Y<-c.velocityThreshold&&(F.velocityBias=-this.v_restitution*Y)}if(2==this.v_pointCount&&t.blockSolve){var N=this.v_points[0],W=this.v_points[1],J=r.cross(N.rA,this.v_normal),H=r.cross(N.rB,this.v_normal),Z=r.cross(W.rA,this.v_normal),X=r.cross(W.rB,this.v_normal),K=v+x+A*J*J+g*H*H,Q=v+x+A*Z*Z+g*X*X,$=v+x+A*J*Z+g*H*X;K*K<1e3*(K*Q-$*$)?(this.v_K.ex.set(K,$),this.v_K.ey.set($,Q),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}u.c.set(w),u.a=S,_.v.set(C),_.w=M,p.c.set(I),p.a=T,l.v.set(P),l.w=V},p.prototype.warmStartConstraint=function(t){for(var e=this.m_fixtureA,i=this.m_fixtureB,s=e.getBody(),o=i.getBody(),n=s.c_velocity,a=o.c_velocity,m=(s.c_position,o.c_position,this.v_invMassA),h=this.v_invIA,c=this.v_invMassB,_=this.v_invIB,l=r.clone(n.v),u=n.w,p=r.clone(a.v),d=a.w,y=this.v_normal,f=r.cross(y,1),v=0;v<this.v_pointCount;++v){var x=this.v_points[v],A=r.combine(x.normalImpulse,y,x.tangentImpulse,f);u-=h*r.cross(x.rA,A),l.subMul(m,A),d+=_*r.cross(x.rB,A),p.addMul(c,A)}n.v.set(l),n.w=u,a.v.set(p),a.w=d},p.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},p.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,a=e.c_velocity,h=(e.c_position,i.c_velocity),c=(i.c_position,this.v_invMassA),_=this.v_invIA,l=this.v_invMassB,u=this.v_invIB,p=r.clone(a.v),d=a.w,y=r.clone(h.v),f=h.w,v=this.v_normal,x=r.cross(v,1),A=this.v_friction;s&&o.assert(1==this.v_pointCount||2==this.v_pointCount);for(var g=0;g<this.v_pointCount;++g){var b=this.v_points[g];(I=r.zero()).addCombine(1,y,1,r.cross(f,b.rB)),I.subCombine(1,p,1,r.cross(d,b.rA));var B=r.dot(I,x)-this.v_tangentSpeed,w=b.tangentMass*-B,S=A*b.normalImpulse;w=(T=n.clamp(b.tangentImpulse+w,-S,S))-b.tangentImpulse,b.tangentImpulse=T;var C=r.mul(w,x);p.subMul(c,C),d-=_*r.cross(b.rA,C),y.addMul(l,C),f+=u*r.cross(b.rB,C)}if(1==this.v_pointCount||0==t.blockSolve)for(var M=0;M<this.v_pointCount;++M){var I;b=this.v_points[M];(I=r.zero()).addCombine(1,y,1,r.cross(f,b.rB)),I.subCombine(1,p,1,r.cross(d,b.rA));var T,P=r.dot(I,v);w=-b.normalMass*(P-b.velocityBias);w=(T=n.max(b.normalImpulse+w,0))-b.normalImpulse,b.normalImpulse=T;C=r.mul(w,v);p.subMul(c,C),d-=_*r.cross(b.rA,C),y.addMul(l,C),f+=u*r.cross(b.rB,C)}else{var V=this.v_points[0],z=this.v_points[1],E=r.neo(V.normalImpulse,z.normalImpulse);s&&o.assert(E.x>=0&&E.y>=0);var L=r.zero().add(y).add(r.cross(f,V.rB)).sub(p).sub(r.cross(d,V.rA)),q=r.zero().add(y).add(r.cross(f,z.rB)).sub(p).sub(r.cross(d,z.rA)),F=r.dot(L,v),D=r.dot(q,v),R=r.neo(F-V.velocityBias,D-z.velocityBias);R.sub(m.mulVec2(this.v_K,E));for(;;){var k=m.mulVec2(this.v_normalMass,R).neg();if(k.x>=0&&k.y>=0){var j=r.sub(k,E),O=r.mul(j.x,v),G=r.mul(j.y,v);p.subCombine(c,O,c,G),d-=_*(r.cross(V.rA,O)+r.cross(z.rA,G)),y.addCombine(l,O,l,G),f+=u*(r.cross(V.rB,O)+r.cross(z.rB,G)),V.normalImpulse=k.x,z.normalImpulse=k.y;break}if(k.x=-V.normalMass*R.x,k.y=0,F=0,D=this.v_K.ex.y*k.x+R.y,k.x>=0&&D>=0){j=r.sub(k,E),O=r.mul(j.x,v),G=r.mul(j.y,v);p.subCombine(c,O,c,G),d-=_*(r.cross(V.rA,O)+r.cross(z.rA,G)),y.addCombine(l,O,l,G),f+=u*(r.cross(V.rB,O)+r.cross(z.rB,G)),V.normalImpulse=k.x,z.normalImpulse=k.y;break}if(k.x=0,k.y=-z.normalMass*R.y,F=this.v_K.ey.x*k.y+R.x,D=0,k.y>=0&&F>=0){j=r.sub(k,E),O=r.mul(j.x,v),G=r.mul(j.y,v);p.subCombine(c,O,c,G),d-=_*(r.cross(V.rA,O)+r.cross(z.rA,G)),y.addCombine(l,O,l,G),f+=u*(r.cross(V.rB,O)+r.cross(z.rB,G)),V.normalImpulse=k.x,z.normalImpulse=k.y;break}if(k.x=0,k.y=0,F=R.x,D=R.y,F>=0&&D>=0){j=r.sub(k,E),O=r.mul(j.x,v),G=r.mul(j.y,v);p.subCombine(c,O,c,G),d-=_*(r.cross(V.rA,O)+r.cross(z.rA,G)),y.addCombine(l,O,l,G),f+=u*(r.cross(V.rB,O)+r.cross(z.rB,G)),V.normalImpulse=k.x,z.normalImpulse=k.y;break}break}}a.v.set(p),a.w=d,h.v.set(y),h.w=f};var v=[];p.addType=function(t,e,i){v[t]=v[t]||{},v[t][e]=i},p.create=function(t,e,i,s){var o,n,r=t.getType(),a=i.getType();if(n=v[r]&&v[r][a])o=new p(t,e,i,s,n);else{if(!(n=v[a]&&v[a][r]))return null;o=new p(i,s,t,e,n)}t=o.getFixtureA(),i=o.getFixtureB(),e=o.getChildIndexA(),s=o.getChildIndexB();var m=t.getBody(),h=i.getBody();return o.m_nodeA.contact=o,o.m_nodeA.other=h,o.m_nodeA.prev=null,o.m_nodeA.next=m.m_contactList,null!=m.m_contactList&&(m.m_contactList.prev=o.m_nodeA),m.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=m,o.m_nodeB.prev=null,o.m_nodeB.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=o.m_nodeB),h.m_contactList=o.m_nodeB,0==t.isSensor()&&0==i.isSensor()&&(m.setAwake(!0),h.setAwake(!0)),o},p.destroy=function(t,e){var i=t.m_fixtureA,s=t.m_fixtureB,o=i.getBody(),n=s.getBody();t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&0==i.isSensor()&&0==s.isSensor()&&(o.setAwake(!0),n.setAwake(!0));var r=i.getType(),a=s.getType(),m=v[r][a].destroyFcn;"function"==typeof m&&m(t)}},7176:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=l;var o=i(1689),n=i(2133),r=i(9540),a=i(5890),m=i(1202),h=i(7998),c={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function _(t,e){this.aabb=new m,this.fixture=t,this.childIndex=e,this.proxyId}function l(t,e,i){e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=n(i,c),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var s=this.m_shape.getChildCount(),o=0;o<s;++o)this.m_proxies[o]=new _(this,o);this.m_userData=i.userData}l.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),s=0;s<i;++s)this.m_proxies[s]=new _(this,s);this.createProxies(e,t.m_xf),t.resetMassData()},l.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},l._deserialize=function(t,e,i){var s=i(h,t.shape);return s&&new l(e,s,t)},l.prototype.getType=function(){return this.m_shape.getType()},l.prototype.getShape=function(){return this.m_shape},l.prototype.isSensor=function(){return this.m_isSensor},l.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},l.prototype.getUserData=function(){return this.m_userData},l.prototype.setUserData=function(t){this.m_userData=t},l.prototype.getBody=function(){return this.m_body},l.prototype.getNext=function(){return this.m_next},l.prototype.getDensity=function(){return this.m_density},l.prototype.setDensity=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_density=t},l.prototype.getFriction=function(){return this.m_friction},l.prototype.setFriction=function(t){this.m_friction=t},l.prototype.getRestitution=function(){return this.m_restitution},l.prototype.setRestitution=function(t){this.m_restitution=t},l.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},l.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},l.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},l.prototype.getAABB=function(t){return s&&o.assert(0<=t&&t<this.m_proxyCount),this.m_proxies[t].aabb},l.prototype.createProxies=function(t,e){s&&o.assert(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i];this.m_shape.computeAABB(n.aabb,e,i),n.proxyId=t.createProxy(n.aabb,n)}},l.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},l.prototype.synchronize=function(t,e,i){for(var s=0;s<this.m_proxyCount;++s){var o=this.m_proxies[s],n=new m,r=new m;this.m_shape.computeAABB(n,e,o.childIndex),this.m_shape.computeAABB(r,i,o.childIndex),o.aabb.combine(n,r);var h=a.sub(i.p,e.p);t.moveProxy(o.proxyId,o.aabb,h)}},l.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},l.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},l.prototype.setFilterGroupIndex=function(t){return this.m_filterGroupIndex=t},l.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},l.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t},l.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},l.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t},l.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),s=e.getFixtureB();i!=this&&s!=this||e.flagForFiltering(),t=t.next}var o=this.m_body.getWorld();if(null!=o)for(var n=o.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},l.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=0!=(t.m_filterMaskBits&this.m_filterCategoryBits),i=0!=(t.m_filterCategoryBits&this.m_filterMaskBits);return e&&i}},7545:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=r;var o=i(1689);function n(){this.other=null,this.joint=null,this.prev=null,this.next=null}function r(t,e,i){e=t.bodyA||e,i=t.bodyB||i,s&&o.assert(e),s&&o.assert(i),s&&o.assert(e!=i),this.m_type="unknown-joint",this.m_bodyA=e,this.m_bodyB=i,this.m_index=0,this.m_collideConnected=!!t.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new n,this.m_edgeB=new n,this.m_islandFlag=!1,this.m_userData=t.userData}r.TYPES={},r._deserialize=function(t,e,i){var s=r.TYPES[t.type];return s&&i(s,t)},r.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},r.prototype.getType=function(){return this.m_type},r.prototype.getBodyA=function(){return this.m_bodyA},r.prototype.getBodyB=function(){return this.m_bodyB},r.prototype.getNext=function(){return this.m_next},r.prototype.getUserData=function(){return this.m_userData},r.prototype.setUserData=function(t){this.m_userData=t},r.prototype.getCollideConnected=function(){return this.m_collideConnected},r.prototype.getAnchorA=function(){},r.prototype.getAnchorB=function(){},r.prototype.getReactionForce=function(t){},r.prototype.getReactionTorque=function(t){},r.prototype.shiftOrigin=function(t){},r.prototype.initVelocityConstraints=function(t){},r.prototype.solveVelocityConstraints=function(t){},r.prototype.solvePositionConstraints=function(t){}},5713:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,i(1689);var s=i(5890),o=i(8558),n=i(9540),r=i(1146);function a(){this.type,this.localNormal=s.zero(),this.localPoint=s.zero(),this.points=[new m,new m],this.pointCount=0}function m(){this.localPoint=s.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new h}function h(){this.cf=new c}function c(){this.indexA,this.indexB,this.typeA,this.typeB}function _(){this.normal,this.points=[],this.separations=[]}t.exports=a,t.exports.clipSegmentToLine=function(t,e,i,o,n){var r=0,m=s.dot(i,e[0].v)-o,h=s.dot(i,e[1].v)-o;m<=0&&t[r++].set(e[0]);h<=0&&t[r++].set(e[1]);if(m*h<0){var c=m/(m-h);t[r].v.setCombine(1-c,e[0].v,c,e[1].v),t[r].id.cf.indexA=n,t[r].id.cf.indexB=e[0].id.cf.indexB,t[r].id.cf.typeA=a.e_vertex,t[r].id.cf.typeB=a.e_face,++r}return r},t.exports.clipVertex=u,t.exports.getPointStates=function(t,e,i,s){for(var o=0;o<i.pointCount;++o){var n=i.points[o].id;t[o]=l.removeState;for(var r=0;r<s.pointCount;++r)if(s.points[r].id.key==n.key){t[o]=l.persistState;break}}for(o=0;o<s.pointCount;++o){n=s.points[o].id;e[o]=l.addState;for(r=0;r<i.pointCount;++r)if(i.points[r].id.key==n.key){e[o]=l.persistState;break}}},t.exports.PointState=l,a.e_circles=0,a.e_faceA=1,a.e_faceB=2,a.e_vertex=0,a.e_face=1,Object.defineProperty(h.prototype,"key",{get:function(){return this.cf.indexA+4*this.cf.indexB+16*this.cf.typeA+64*this.cf.typeB},enumerable:!0,configurable:!0}),h.prototype.set=function(t){this.cf.set(t.cf)},c.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},a.prototype.getWorldManifold=function(t,e,i,m,h){if(0!=this.pointCount){var c=(t=t||new _).normal,l=t.points,u=t.separations;switch(this.type){case a.e_circles:c=s.neo(1,0);var p=o.mulVec2(e,this.localPoint),d=o.mulVec2(m,this.points[0].localPoint),y=s.sub(d,p);s.lengthSquared(y)>n.EPSILON*n.EPSILON&&(c.set(y),c.normalize());var f=p.clone().addMul(i,c),v=d.clone().addMul(-h,c);l[0]=s.mid(f,v),u[0]=s.dot(s.sub(v,f),c),l.length=1,u.length=1;break;case a.e_faceA:c=r.mulVec2(e.q,this.localNormal);for(var x=o.mulVec2(e,this.localPoint),A=0;A<this.pointCount;++A){var g=o.mulVec2(m,this.points[A].localPoint);f=s.clone(g).addMul(i-s.dot(s.sub(g,x),c),c),v=s.clone(g).subMul(h,c);l[A]=s.mid(f,v),u[A]=s.dot(s.sub(v,f),c)}l.length=this.pointCount,u.length=this.pointCount;break;case a.e_faceB:c=r.mulVec2(m.q,this.localNormal);for(x=o.mulVec2(m,this.localPoint),A=0;A<this.pointCount;++A){g=o.mulVec2(e,this.points[A].localPoint),v=s.combine(1,g,h-s.dot(s.sub(g,x),c),c),f=s.combine(1,g,-i,c);l[A]=s.mid(f,v),u[A]=s.dot(s.sub(f,v),c)}l.length=this.pointCount,u.length=this.pointCount,c.mul(-1)}return t.normal=c,t.points=l,t.separations=u,t}};var l={nullState:0,addState:1,persistState:2,removeState:3};function u(){this.v=s.zero(),this.id=new h}u.prototype.set=function(t){this.v.set(t.v),this.id.set(t.id)}},3883:(t,e)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;var i=e;i.maxManifoldPoints=2,i.maxPolygonVertices=12,i.aabbExtension=.1,i.aabbMultiplier=2,i.linearSlop=.005,i.linearSlopSquared=i.linearSlop*i.linearSlop,i.angularSlop=2/180*Math.PI,i.polygonRadius=2*i.linearSlop,i.maxSubSteps=8,i.maxTOIContacts=32,i.maxTOIIterations=20,i.maxDistnceIterations=20,i.velocityThreshold=1,i.maxLinearCorrection=.2,i.maxAngularCorrection=8/180*Math.PI,i.maxTranslation=2,i.maxTranslationSquared=i.maxTranslation*i.maxTranslation,i.maxRotation=.5*Math.PI,i.maxRotationSquared=i.maxRotation*i.maxRotation,i.baumgarte=.2,i.toiBaugarte=.75,i.timeToSleep=.5,i.linearSleepTolerance=.01,i.linearSleepToleranceSqr=Math.pow(i.linearSleepTolerance,2),i.angularSleepTolerance=2/180*Math.PI,i.angularSleepToleranceSqr=Math.pow(i.angularSleepTolerance,2)},7998:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=s;i(9540);function s(){this.m_type,this.m_radius}s.prototype._reset=function(){},s.prototype._serialize=function(){return{}},s.TYPES={},s._deserialize=function(t,e,i){var o=s.TYPES[t.type];return o&&i(o,t)},s.isValid=function(t){return!!t},s.prototype.getRadius=function(){return this.m_radius},s.prototype.getType=function(){return this.m_type},s.prototype._clone=function(){},s.prototype.getChildCount=function(){},s.prototype.testPoint=function(t,e){},s.prototype.rayCast=function(t,e,i,s){},s.prototype.computeAABB=function(t,e,i){},s.prototype.computeMass=function(t,e){},s.prototype.computeDistanceProxy=function(t){}},2508:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=f,t.exports.TimeStep=y;var n=i(3883),r=i(1689),a=i(5890),m=i(9540),h=i(5786),c=i(5676),_=i(7545),l=i(3229),u=l.Input,p=l.Output,d=i(4735);d.Input,d.Output,d.Proxy,d.Cache;function y(t){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}function f(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}y.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},f.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},f.prototype.addBody=function(t){o&&r.assert(t instanceof h,"Not a Body!",t),this.m_bodies.push(t)},f.prototype.addContact=function(t){o&&r.assert(t instanceof c,"Not a Contact!",t),this.m_contacts.push(t)},f.prototype.addJoint=function(t){o&&r.assert(t instanceof _,"Not a Joint!",t),this.m_joints.push(t)},f.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var s=e.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=e.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var a=this.m_stack,m=e.m_bodyList;m;m=m.m_next)if(!m.m_islandFlag&&0!=m.isAwake()&&0!=m.isActive()&&!m.isStatic()){for(this.clear(),a.push(m),m.m_islandFlag=!0;a.length>0;){i=a.pop();if(o&&r.assert(1==i.isActive()),this.addBody(i),i.setAwake(!0),!i.isStatic()){for(var h=i.m_contactList;h;h=h.next){var c=h.contact;if(!c.m_islandFlag&&(0!=c.isEnabled()&&0!=c.isTouching())){var _=c.m_fixtureA.m_isSensor,l=c.m_fixtureB.m_isSensor;if(!_&&!l)this.addContact(c),c.m_islandFlag=!0,(p=h.other).m_islandFlag||(a.push(p),p.m_islandFlag=!0)}}for(var u=i.m_jointList;u;u=u.next){var p;if(1!=u.joint.m_islandFlag)0!=(p=u.other).isActive()&&(this.addJoint(u.joint),u.joint.m_islandFlag=!0,p.m_islandFlag||(a.push(p),p.m_islandFlag=!0))}}}this.solveIsland(t);for(var d=0;d<this.m_bodies.length;++d){(i=this.m_bodies[d]).isStatic()&&(i.m_islandFlag=!1)}}},f.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,o=e.m_allowSleep,r=t.dt,h=0;h<this.m_bodies.length;++h){var c=this.m_bodies[h],_=a.clone(c.m_sweep.c),l=c.m_sweep.a,u=a.clone(c.m_linearVelocity),p=c.m_angularVelocity;c.m_sweep.c0.set(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.isDynamic()&&(u.addMul(r*c.m_gravityScale,i),u.addMul(r*c.m_invMass,c.m_force),p+=r*c.m_invI*c.m_torque,u.mul(1/(1+r*c.m_linearDamping)),p*=1/(1+r*c.m_angularDamping)),c.c_position.c=_,c.c_position.a=l,c.c_velocity.v=u,c.c_velocity.w=p}for(h=0;h<this.m_contacts.length;++h){this.m_contacts[h].initConstraint(t)}s&&this.printBodies("M: ");for(h=0;h<this.m_contacts.length;++h){this.m_contacts[h].initVelocityConstraint(t)}if(s&&this.printBodies("R: "),t.warmStarting)for(h=0;h<this.m_contacts.length;++h){this.m_contacts[h].warmStartConstraint(t)}s&&this.printBodies("Q: ");for(h=0;h<this.m_joints.length;++h){this.m_joints[h].initVelocityConstraints(t)}s&&this.printBodies("E: ");for(h=0;h<t.velocityIterations;++h){for(var d=0;d<this.m_joints.length;++d){this.m_joints[d].solveVelocityConstraints(t)}for(d=0;d<this.m_contacts.length;++d){this.m_contacts[d].solveVelocityConstraint(t)}}s&&this.printBodies("D: ");for(h=0;h<this.m_contacts.length;++h){this.m_contacts[h].storeConstraintImpulses(t)}s&&this.printBodies("C: ");for(h=0;h<this.m_bodies.length;++h){c=this.m_bodies[h],_=a.clone(c.c_position.c),l=c.c_position.a,u=a.clone(c.c_velocity.v),p=c.c_velocity.w;var y=a.mul(r,u);if(a.lengthSquared(y)>n.maxTranslationSquared){var f=n.maxTranslation/y.length();u.mul(f)}var v=r*p;if(v*v>n.maxRotationSquared)p*=f=n.maxRotation/m.abs(v);_.addMul(r,u),l+=r*p,c.c_position.c.set(_),c.c_position.a=l,c.c_velocity.v.set(u),c.c_velocity.w=p}s&&this.printBodies("B: ");var x=!1;for(h=0;h<t.positionIterations;++h){var A=0;for(d=0;d<this.m_contacts.length;++d){var g=this.m_contacts[d].solvePositionConstraint(t);A=m.min(A,g)}var b=A>=-3*n.linearSlop,B=!0;for(d=0;d<this.m_joints.length;++d){var w=this.m_joints[d].solvePositionConstraints(t);B=B&&w}if(b&&B){x=!0;break}}s&&this.printBodies("L: ");for(h=0;h<this.m_bodies.length;++h){(c=this.m_bodies[h]).m_sweep.c.set(c.c_position.c),c.m_sweep.a=c.c_position.a,c.m_linearVelocity.set(c.c_velocity.v),c.m_angularVelocity=c.c_velocity.w,c.synchronizeTransform()}if(this.postSolveIsland(),o){var S=1/0,C=n.linearSleepToleranceSqr,M=n.angularSleepToleranceSqr;for(h=0;h<this.m_bodies.length;++h){(c=this.m_bodies[h]).isStatic()||(0==c.m_autoSleepFlag||c.m_angularVelocity*c.m_angularVelocity>M||a.lengthSquared(c.m_linearVelocity)>C?(c.m_sleepTime=0,S=0):(c.m_sleepTime+=r,S=m.min(S,c.m_sleepTime)))}if(S>=n.timeToSleep&&x)for(h=0;h<this.m_bodies.length;++h){(c=this.m_bodies[h]).setAwake(!1)}}},f.prototype.printBodies=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[e];r.debug(t,i.c_position.a,i.c_position.c.x,i.c_position.c.y,i.c_velocity.w,i.c_velocity.v.x,i.c_velocity.v.y)}};var v=new y;function x(){this.normalImpulses=[],this.tangentImpulses=[]}f.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var a=e.m_contactList;a;a=a.m_next)a.m_toiFlag=!1,a.m_islandFlag=!1,a.m_toiCount=0,a.m_toi=1}for(;;){var h=null,c=1;for(a=e.m_contactList;a;a=a.m_next)if(0!=a.isEnabled()&&!(a.m_toiCount>n.maxSubSteps)){var _=1;if(a.m_toiFlag)_=a.m_toi;else{var d=a.getFixtureA(),y=a.getFixtureB();if(d.isSensor()||y.isSensor())continue;var f=d.getBody(),x=y.getBody();o&&r.assert(f.isDynamic()||x.isDynamic());var A=f.isAwake()&&!f.isStatic(),g=x.isAwake()&&!x.isStatic();if(0==A&&0==g)continue;var b=f.isBullet()||!f.isDynamic(),B=x.isBullet()||!x.isDynamic();if(0==b&&0==B)continue;var w=f.m_sweep.alpha0;f.m_sweep.alpha0<x.m_sweep.alpha0?(w=x.m_sweep.alpha0,f.m_sweep.advance(w)):x.m_sweep.alpha0<f.m_sweep.alpha0&&(w=f.m_sweep.alpha0,x.m_sweep.advance(w)),o&&r.assert(w<1);var S=a.getChildIndexA(),C=a.getChildIndexB(),M=(f.m_sweep,x.m_sweep,new u);M.proxyA.set(d.getShape(),S),M.proxyB.set(y.getShape(),C),M.sweepA.set(f.m_sweep),M.sweepB.set(x.m_sweep),M.tMax=1;var I=new p;l(I,M);var T=I.t;_=I.state==p.e_touching?m.min(w+(1-w)*T,1):1,a.m_toi=_,a.m_toiFlag=!0}_<c&&(h=a,c=_)}if(null==h||1-10*m.EPSILON<c){e.m_stepComplete=!0;break}d=h.getFixtureA(),y=h.getFixtureB(),f=d.getBody(),x=y.getBody();var P=f.m_sweep.clone(),V=x.m_sweep.clone();if(f.advance(c),x.advance(c),h.update(e),h.m_toiFlag=!1,++h.m_toiCount,0!=h.isEnabled()&&0!=h.isTouching()){f.setAwake(!0),x.setAwake(!0),this.clear(),this.addBody(f),this.addBody(x),this.addContact(h),f.m_islandFlag=!0,x.m_islandFlag=!0,h.m_islandFlag=!0;for(var z=[f,x],E=0;E<z.length;++E){if((j=z[E]).isDynamic())for(var L=j.m_contactList;L;L=L.next){var q=L.contact;if(!q.m_islandFlag){var F=L.other;if(!F.isDynamic()||j.isBullet()||F.isBullet()){var D=q.m_fixtureA.m_isSensor,R=q.m_fixtureB.m_isSensor;if(!D&&!R){var k=F.m_sweep.clone();0==F.m_islandFlag&&F.advance(c),q.update(e),0!=q.isEnabled()&&0!=q.isTouching()?(q.m_islandFlag=!0,this.addContact(q),F.m_islandFlag||(F.m_islandFlag=!0,F.isStatic()||F.setAwake(!0),this.addBody(F))):(F.m_sweep.set(k),F.synchronizeTransform())}}}}}v.reset((1-c)*t.dt),v.dtRatio=1,v.positionIterations=20,v.velocityIterations=t.velocityIterations,v.warmStarting=!1,this.solveIslandTOI(v,f,x);for(E=0;E<this.m_bodies.length;++E){var j;if((j=this.m_bodies[E]).m_islandFlag=!1,j.isDynamic()){j.synchronizeFixtures();for(L=j.m_contactList;L;L=L.next)L.contact.m_toiFlag=!1,L.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}else h.setEnabled(!1),f.m_sweep.set(P),x.m_sweep.set(V),f.synchronizeTransform(),x.synchronizeTransform()}if(s)for(i=e.m_bodyList;i;i=i.m_next)a=i.m_sweep.c,i.m_sweep.a,i.m_linearVelocity,i.m_angularVelocity},f.prototype.solveIslandTOI=function(t,e,i){this.m_world;for(var s=0;s<this.m_bodies.length;++s){(_=this.m_bodies[s]).c_position.c.set(_.m_sweep.c),_.c_position.a=_.m_sweep.a,_.c_velocity.v.set(_.m_linearVelocity),_.c_velocity.w=_.m_angularVelocity}for(var s=0;s<this.m_contacts.length;++s){this.m_contacts[s].initConstraint(t)}for(s=0;s<t.positionIterations;++s){for(var o=0,r=0;r<this.m_contacts.length;++r){var h=this.m_contacts[r].solvePositionConstraintTOI(t,e,i);o=m.min(o,h)}if(o>=-1.5*n.linearSlop)break}e.m_sweep.c0.set(e.c_position.c),e.m_sweep.a0=e.c_position.a,i.m_sweep.c0.set(i.c_position.c),i.m_sweep.a0=i.c_position.a;for(s=0;s<this.m_contacts.length;++s){this.m_contacts[s].initVelocityConstraint(t)}for(s=0;s<t.velocityIterations;++s)for(r=0;r<this.m_contacts.length;++r){this.m_contacts[r].solveVelocityConstraint(t)}var c=t.dt;for(s=0;s<this.m_bodies.length;++s){var _=this.m_bodies[s],l=a.clone(_.c_position.c),u=_.c_position.a,p=a.clone(_.c_velocity.v),d=_.c_velocity.w,y=a.mul(c,p);if(a.dot(y,y)>n.maxTranslationSquared){var f=n.maxTranslation/y.length();p.mul(f)}var v=c*d;if(v*v>n.maxRotationSquared)d*=f=n.maxRotation/m.abs(v);l.addMul(c,p),u+=c*d,_.c_position.c=l,_.c_position.a=u,_.c_velocity.v=p,_.c_velocity.w=d,_.m_sweep.c=l,_.m_sweep.a=u,_.m_linearVelocity=p,_.m_angularVelocity=d,_.synchronizeTransform()}this.postSolveIsland()},f.prototype.postSolveIsland=function(){for(var t=new x,e=0;e<this.m_contacts.length;++e){for(var i=this.m_contacts[e],s=0;s<i.v_points.length;++s)t.normalImpulses.push(i.v_points[s].normalImpulse),t.tangentImpulses.push(i.v_points[s].tangentImpulse);this.m_world.postSolve(i,t)}}},856:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(2133),n=i(1689),r=i(5890),a=i(6752),m=i(2508),h=i(5786),c=i(7545),_=i(5676),l={gravity:r.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function u(t){if(!(this instanceof u))return new u(t);t&&r.isValid(t)&&(t={gravity:t}),t=o(t,l),this.m_solver=new m(this),this.m_broadPhase=new a,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=r.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0,this.addPair=this.createContact.bind(this)}u.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var s=this.getJointList();s;s=s.getNext())"function"==typeof s._serialize&&e.push(s);return{gravity:this.m_gravity,bodies:t,joints:e}},u._deserialize=function(t,e,i){if(!t)return new u;var s=new u(t.gravity);if(t.bodies)for(var o=t.bodies.length-1;o>=0;o-=1)s._addBody(i(h,t.bodies[o],s));if(t.joints)for(o=t.joints.length-1;o>=0;o--)s.createJoint(i(c,t.joints[o],s));return s},u.prototype.getBodyList=function(){return this.m_bodyList},u.prototype.getJointList=function(){return this.m_jointList},u.prototype.getContactList=function(){return this.m_contactList},u.prototype.getBodyCount=function(){return this.m_bodyCount},u.prototype.getJointCount=function(){return this.m_jointCount},u.prototype.getContactCount=function(){return this.m_contactCount},u.prototype.setGravity=function(t){this.m_gravity=t},u.prototype.getGravity=function(){return this.m_gravity},u.prototype.isLocked=function(){return this.m_locked},u.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},u.prototype.getAllowSleeping=function(){return this.m_allowSleep},u.prototype.setWarmStarting=function(t){this.m_warmStarting=t},u.prototype.getWarmStarting=function(){return this.m_warmStarting},u.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},u.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},u.prototype.setSubStepping=function(t){this.m_subStepping=t},u.prototype.getSubStepping=function(){return this.m_subStepping},u.prototype.setAutoClearForces=function(t){this.m_clearForces=t},u.prototype.getAutoClearForces=function(){return this.m_clearForces},u.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},u.prototype.queryAABB=function(t,e){s&&n.assert("function"==typeof e);var i=this.m_broadPhase;this.m_broadPhase.query(t,(function(t){var s=i.getUserData(t);return e(s.fixture)}))},u.prototype.rayCast=function(t,e,i){s&&n.assert("function"==typeof i);var o=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},(function(t,e){var s=o.getUserData(e),n=s.fixture,a=s.childIndex,m={};if(n.rayCast(m,t,a)){var h=m.fraction,c=r.add(r.mul(1-h,t.p1),r.mul(h,t.p2));return i(n,c,m.normal,h)}return t.maxFraction}))},u.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},u.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},u.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},u.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},u.prototype.shiftOrigin=function(t){if(s&&n.assert(0==this.m_locked),!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},u.prototype._addBody=function(t){s&&n.assert(!1===this.isLocked()),this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},u.prototype.createBody=function(t,e){if(s&&n.assert(0==this.isLocked()),this.isLocked())return null;t&&r.isValid(t)&&(t={position:t,angle:e});var i=new h(this,t);return this._addBody(i),i},u.prototype.createDynamicBody=function(t,e){return t?r.isValid(t)&&(t={position:t,angle:e}):t={},t.type="dynamic",this.createBody(t)},u.prototype.createKinematicBody=function(t,e){return t?r.isValid(t)&&(t={position:t,angle:e}):t={},t.type="kinematic",this.createBody(t)},u.prototype.destroyBody=function(t){if(s&&n.assert(this.m_bodyCount>0),s&&n.assert(0==this.isLocked()),!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var r=o;o=o.next,this.destroyContact(r.contact),t.m_contactList=o}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var m=a;a=a.m_next,this.publish("remove-fixture",m),m.destroyProxies(this.m_broadPhase),t.m_fixtureList=a}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},u.prototype.createJoint=function(t){if(s&&n.assert(!!t.m_bodyA),s&&n.assert(!!t.m_bodyB),s&&n.assert(0==this.isLocked()),this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},u.prototype.destroyJoint=function(t){if(s&&n.assert(0==this.isLocked()),!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,s&&n.assert(this.m_jointCount>0),--this.m_jointCount,0==t.m_collideConnected)for(var o=i.getContactList();o;)o.other==e&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}};var p=new m.TimeStep;u.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,p.reset(t),p.velocityIterations=e,p.positionIterations=i,p.warmStarting=this.m_warmStarting,p.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(p);for(var s=this.m_bodyList;s;s=s.getNext())0!=s.m_islandFlag&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(p),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},u.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)},u.prototype.createContact=function(t,e){var i=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,r=i.getBody(),a=s.getBody();if(r!=a){for(var m=a.getContactList();m;){if(m.other==r){var h=m.contact.getFixtureA(),c=m.contact.getFixtureB(),l=m.contact.getChildIndexA(),u=m.contact.getChildIndexB();if(h==i&&c==s&&l==o&&u==n)return;if(h==s&&c==i&&l==n&&u==o)return}m=m.next}if(0!=a.shouldCollide(r)&&0!=s.shouldCollide(i)){var p=_.create(i,o,s,n);null!=p&&(p.m_prev=null,null!=this.m_contactList&&(p.m_next=this.m_contactList,this.m_contactList.m_prev=p),this.m_contactList=p,++this.m_contactCount)}}},u.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),s=t.getFixtureB(),o=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),a=s.getBody();if(t.m_filterFlag){if(0==a.shouldCollide(r)){this.destroyContact(t);continue}if(0==s.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var m=r.isAwake()&&!r.isStatic(),h=a.isAwake()&&!a.isStatic();if(0!=m||0!=h){var c=i.m_proxies[o].proxyId,_=s.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(c,_)?t.update(this):this.destroyContact(t)}}},u.prototype.destroyContact=function(t){_.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},u.prototype._listeners=null,u.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},u.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var s=i.indexOf(e);return s>=0&&i.splice(s,1),this},u.prototype.publish=function(t,e,i,s){var o=this._listeners&&this._listeners[t];if(!o||!o.length)return 0;for(var n=0;n<o.length;n++)o[n].call(this,e,i,s);return o.length},u.prototype.beginContact=function(t){this.publish("begin-contact",t)},u.prototype.endContact=function(t){this.publish("end-contact",t)},u.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},u.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)}},1202:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT,n=(i(3883),i(1689)),r=i(9540),a=i(5890);function m(t,e){if(!(this instanceof m))return new m(t,e);this.lowerBound=a.zero(),this.upperBound=a.zero(),"object"==typeof t&&this.lowerBound.set(t),"object"==typeof e?this.upperBound.set(e):"object"==typeof t&&this.upperBound.set(t)}t.exports=m,m.prototype.isValid=function(){return m.isValid(this)},m.isValid=function(t){var e=a.sub(t.upperBound,t.lowerBound);return e.x>=0&&e.y>=0&&a.isValid(t.lowerBound)&&a.isValid(t.upperBound)},m.assert=function(t){if(o&&!m.isValid(t))throw s&&n.debug(t),new Error("Invalid AABB!")},m.prototype.getCenter=function(){return a.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},m.prototype.getExtents=function(){return a.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},m.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},m.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,s=t.upperBound,o=e.lowerBound,n=e.upperBound,a=r.min(i.x,o.x),m=r.min(i.y,o.y),h=r.max(n.x,s.x),c=r.max(n.y,s.y);this.lowerBound.set(a,m),this.upperBound.set(h,c)},m.prototype.combinePoints=function(t,e){this.lowerBound.set(r.min(t.x,e.x),r.min(t.y,e.y)),this.upperBound.set(r.max(t.x,e.x),r.max(t.y,e.y))},m.prototype.set=function(t){this.lowerBound.set(t.lowerBound.x,t.lowerBound.y),this.upperBound.set(t.upperBound.x,t.upperBound.y)},m.prototype.contains=function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},m.prototype.extend=function(t){return m.extend(this,t),this},m.extend=function(t,e){t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e},m.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,o=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0||o>0||s>0||n>0)},m.areEqual=function(t,e){return a.areEqual(t.lowerBound,e.lowerBound)&&a.areEqual(t.upperBound,e.upperBound)},m.diff=function(t,e){var i=r.max(0,r.min(t.upperBound.x,e.upperBound.x)-r.max(e.lowerBound.x,t.lowerBound.x)),s=r.max(0,r.min(t.upperBound.y,e.upperBound.y)-r.max(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*s},m.prototype.rayCast=function(t,e){for(var i=-1/0,s=1/0,o=e.p1,n=a.sub(e.p2,e.p1),m=a.abs(n),h=a.zero(),c="x";null!==c;c="x"===c?"y":null)if(m.x<r.EPSILON){if(o[c]<this.lowerBound[c]||this.upperBound[c]<o[c])return!1}else{var _=1/n[c],l=(this.lowerBound[c]-o[c])*_,u=(this.upperBound[c]-o[c])*_,p=-1;if(l>u){var d=l;l=u,u=d,p=1}if(l>i&&(h.setZero(),h[c]=p,i=l),i>(s=r.min(s,u)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,t.normal=h,!0)},m.prototype.toString=function(){return JSON.stringify(this)}},6752:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=(i(3883),i(1689)),n=i(9540),r=i(1202),a=i(5326);function m(){this.m_tree=new a,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}t.exports=m,m.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},m.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return r.testOverlap(i,s)},m.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},m.prototype.getProxyCount=function(){return this.m_proxyCount},m.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},m.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},m.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},m.prototype.query=function(t,e){this.m_tree.query(t,e)},m.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},m.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},m.prototype.createProxy=function(t,e){s&&o.assert(r.isValid(t));var i=this.m_tree.createProxy(t,e);return this.m_proxyCount++,this.bufferMove(i),i},m.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},m.prototype.moveProxy=function(t,e,i){s&&o.assert(r.isValid(e)),this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},m.prototype.touchProxy=function(t){this.bufferMove(t)},m.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},m.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]==t&&(this.m_moveBuffer[e]=null)},m.prototype.updatePairs=function(t){for(s&&o.assert("function"==typeof t),this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},m.prototype.queryCallback=function(t){if(t==this.m_queryProxyId)return!0;var e=n.min(t,this.m_queryProxyId),i=n.max(t,this.m_queryProxyId),s=this.m_tree.getUserData(e),o=this.m_tree.getUserData(i);return this.m_callback(s,o),!0}},4735:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=p,t.exports.Input=_,t.exports.Output=l,t.exports.Proxy=d,t.exports.Cache=u;var o=i(3883),n=i(1689),r=i(6693),a=i(9540),m=i(5890),h=(i(3588),i(6514),i(2149),i(1146)),c=(i(8804),i(8558));i(830),i(7501);function _(){this.proxyA=new d,this.proxyB=new d,this.transformA=null,this.transformB=null,this.useRadii=!1}function l(){this.pointA=m.zero(),this.pointB=m.zero(),this.distance,this.iterations}function u(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function p(t,e,i){++r.gjkCalls;var s=i.proxyA,n=i.proxyB,_=i.transformA,l=i.transformB,u=new f;u.readCache(e,s,_,n,l);for(var p=u.m_v,d=o.maxDistnceIterations,y=[],v=[],x=0,A=0;A<d;){x=u.m_count;for(var g=0;g<x;++g)y[g]=p[g].indexA,v[g]=p[g].indexB;if(u.solve(),3==u.m_count)break;(I=u.getClosestPoint()).lengthSquared();var b=u.getSearchDirection();if(b.lengthSquared()<a.EPSILON*a.EPSILON)break;var B=p[u.m_count];B.indexA=s.getSupport(h.mulTVec2(_.q,m.neg(b))),B.wA=c.mulVec2(_,s.getVertex(B.indexA)),B.indexB=n.getSupport(h.mulTVec2(l.q,b)),B.wB=c.mulVec2(l,n.getVertex(B.indexB)),B.w=m.sub(B.wB,B.wA),++A,++r.gjkIters;var w=!1;for(g=0;g<x;++g)if(B.indexA==y[g]&&B.indexB==v[g]){w=!0;break}if(w)break;++u.m_count}if(r.gjkMaxIters=a.max(r.gjkMaxIters,A),u.getWitnessPoints(t.pointA,t.pointB),t.distance=m.distance(t.pointA,t.pointB),t.iterations=A,u.writeCache(e),i.useRadii){var S=s.m_radius,C=n.m_radius;if(t.distance>S+C&&t.distance>a.EPSILON){t.distance-=S+C;var M=m.sub(t.pointB,t.pointA);M.normalize(),t.pointA.addMul(S,M),t.pointB.subMul(C,M)}else{var I=m.mid(t.pointA,t.pointB);t.pointA.set(I),t.pointB.set(I),t.distance=0}}}function d(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}function y(){this.indexA,this.indexB,this.wA=m.zero(),this.wB=m.zero(),this.w=m.zero(),this.a}function f(){this.m_v1=new y,this.m_v2=new y,this.m_v3=new y,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}r.gjkCalls=0,r.gjkIters=0,r.gjkMaxIters=0,d.prototype.getVertexCount=function(){return this.m_count},d.prototype.getVertex=function(t){return s&&n.assert(0<=t&&t<this.m_count),this.m_vertices[t]},d.prototype.getSupport=function(t){for(var e=0,i=m.dot(this.m_vertices[0],t),s=0;s<this.m_count;++s){var o=m.dot(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e},d.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},d.prototype.set=function(t,e){s&&n.assert("function"==typeof t.computeDistanceProxy),t.computeDistanceProxy(this,e)},y.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=m.clone(t.wA),this.wB=m.clone(t.wB),this.w=m.clone(t.w),this.a=t.a},f.prototype.print=function(){return 3==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},f.prototype.readCache=function(t,e,i,o,r){s&&n.assert(t.count<=3),this.m_count=t.count;for(var h=0;h<this.m_count;++h){(d=this.m_v[h]).indexA=t.indexA[h],d.indexB=t.indexB[h];var _=e.getVertex(d.indexA),l=o.getVertex(d.indexB);d.wA=c.mulVec2(i,_),d.wB=c.mulVec2(r,l),d.w=m.sub(d.wB,d.wA),d.a=0}if(this.m_count>1){var u=t.metric,p=this.getMetric();(p<.5*u||2*u<p||p<a.EPSILON)&&(this.m_count=0)}if(0==this.m_count){var d;(d=this.m_v[0]).indexA=0,d.indexB=0;_=e.getVertex(0),l=o.getVertex(0);d.wA=c.mulVec2(i,_),d.wB=c.mulVec2(r,l),d.w=m.sub(d.wB,d.wA),d.a=1,this.m_count=1}},f.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},f.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return m.neg(this.m_v1.w);case 2:var t=m.sub(this.m_v2.w,this.m_v1.w);return m.cross(t,m.neg(this.m_v1.w))>0?m.cross(1,t):m.cross(t,1);default:return s&&n.assert(!1),m.zero()}},f.prototype.getClosestPoint=function(){switch(this.m_count){case 0:default:return s&&n.assert(!1),m.zero();case 1:return m.clone(this.m_v1.w);case 2:return m.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:return m.zero()}},f.prototype.getWitnessPoints=function(t,e){switch(this.m_count){case 0:default:s&&n.assert(!1);break;case 1:t.set(this.m_v1.wA),e.set(this.m_v1.wB);break;case 2:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),e.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.addMul(this.m_v3.a,this.m_v3.wA),e.set(t)}},f.prototype.getMetric=function(){switch(this.m_count){case 0:default:return s&&n.assert(!1),0;case 1:return 0;case 2:return m.distance(this.m_v1.w,this.m_v2.w);case 3:return m.cross(m.sub(this.m_v2.w,this.m_v1.w),m.sub(this.m_v3.w,this.m_v1.w))}},f.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break;default:s&&n.assert(!1)}},f.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=m.sub(e,t),s=-m.dot(t,i);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);var o=m.dot(e,i);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var n=1/(o+s);this.m_v1.a=o*n,this.m_v2.a=s*n,this.m_count=2},f.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=m.sub(e,t),o=m.dot(t,s),n=m.dot(e,s),r=-o,a=m.sub(i,t),h=m.dot(t,a),c=m.dot(i,a),_=-h,l=m.sub(i,e),u=m.dot(e,l),p=m.dot(i,l),d=-u,y=m.cross(s,a),f=y*m.cross(e,i),v=y*m.cross(i,t),x=y*m.cross(t,e);if(r<=0&&_<=0)return this.m_v1.a=1,void(this.m_count=1);if(n>0&&r>0&&x<=0){var A=1/(n+r);return this.m_v1.a=n*A,this.m_v2.a=r*A,void(this.m_count=2)}if(c>0&&_>0&&v<=0){var g=1/(c+_);return this.m_v1.a=c*g,this.m_v3.a=_*g,this.m_count=2,void this.m_v2.set(this.m_v3)}if(n<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(c<=0&&p<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(p>0&&d>0&&f<=0){var b=1/(p+d);return this.m_v2.a=p*b,this.m_v3.a=d*b,this.m_count=2,void this.m_v1.set(this.m_v3)}var B=1/(f+v+x);this.m_v1.a=f*B,this.m_v2.a=v*B,this.m_v3.a=x*B,this.m_count=3},p.testOverlap=function(t,e,i,s,o,n){var r=new _;r.proxyA.set(t,e),r.proxyB.set(i,s),r.transformA=o,r.transformB=n,r.useRadii=!0;var m=new u,h=new l;return p(h,m,r),h.distance<10*a.EPSILON}},5326:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(3883),n=i(1689),r=i(8621),a=i(5890),m=i(9540),h=i(1202);function c(t){this.id=t,this.aabb=new h,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}function _(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new r({create:function(){return new c}})}t.exports=_,c.prototype.isLeaf=function(){return null==this.child1},_.prototype.getUserData=function(t){var e=this.m_nodes[t];return s&&n.assert(!!e),e.userData},_.prototype.getFatAABB=function(t){var e=this.m_nodes[t];return s&&n.assert(!!e),e.aabb},_.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t,t},_.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},_.prototype.createProxy=function(t,e){s&&n.assert(h.isValid(t));var i=this.allocateNode();return i.aabb.set(t),h.extend(i.aabb,o.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},_.prototype.destroyProxy=function(t){var e=this.m_nodes[t];s&&n.assert(!!e),s&&n.assert(e.isLeaf()),this.removeLeaf(e),this.freeNode(e)},_.prototype.moveProxy=function(t,e,i){s&&n.assert(h.isValid(e)),s&&n.assert(!i||a.isValid(i));var r=this.m_nodes[t];return s&&n.assert(!!r),s&&n.assert(r.isLeaf()),!r.aabb.contains(e)&&(this.removeLeaf(r),r.aabb.set(e),e=r.aabb,h.extend(e,o.aabbExtension),i.x<0?e.lowerBound.x+=i.x*o.aabbMultiplier:e.upperBound.x+=i.x*o.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*o.aabbMultiplier:e.upperBound.y+=i.y*o.aabbMultiplier,this.insertLeaf(r),!0)},_.prototype.insertLeaf=function(t){if(s&&n.assert(h.isValid(t.aabb)),null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;0==i.isLeaf();){var o=i.child1,r=i.child2,a=i.aabb.getPerimeter(),c=new h;c.combine(i.aabb,e);var _,l,u=c.getPerimeter(),p=2*u,d=2*(u-a);if(o.isLeaf()){(f=new h).combine(e,o.aabb),_=f.getPerimeter()+d}else{(f=new h).combine(e,o.aabb);var y=o.aabb.getPerimeter();_=f.getPerimeter()-y+d}if(r.isLeaf()){(f=new h).combine(e,r.aabb),l=f.getPerimeter()+d}else{var f;(f=new h).combine(e,r.aabb);y=r.aabb.getPerimeter();l=f.getPerimeter()-y+d}if(p<_&&p<l)break;i=_<l?o:r}var v=i,x=v.parent,A=this.allocateNode();for(A.parent=x,A.userData=null,A.aabb.combine(e,v.aabb),A.height=v.height+1,null!=x?(x.child1==v?x.child1=A:x.child2=A,A.child1=v,A.child2=t,v.parent=A,t.parent=A):(A.child1=v,A.child2=t,v.parent=A,t.parent=A,this.m_root=A),i=t.parent;null!=i;){o=(i=this.balance(i)).child1,r=i.child2;s&&n.assert(null!=o),s&&n.assert(null!=r),i.height=1+m.max(o.height,r.height),i.aabb.combine(o.aabb,r.aabb),i=i.parent}},_.prototype.removeLeaf=function(t){if(t!=this.m_root){var e,i=t.parent,s=i.parent;if(e=i.child1==t?i.child2:i.child1,null!=s){s.child1==i?s.child1=e:s.child2=e,e.parent=s,this.freeNode(i);for(var o=s;null!=o;){var n=(o=this.balance(o)).child1,r=o.child2;o.aabb.combine(n.aabb,r.aabb),o.height=1+m.max(n.height,r.height),o=o.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)}else this.m_root=null},_.prototype.balance=function(t){s&&n.assert(null!=t);var e=t;if(e.isLeaf()||e.height<2)return t;var i=e.child1,o=e.child2,r=o.height-i.height;if(r>1){var a=o.child1,h=o.child2;return o.child1=e,o.parent=e.parent,e.parent=o,null!=o.parent?o.parent.child1==t?o.parent.child1=o:o.parent.child2=o:this.m_root=o,a.height>h.height?(o.child2=a,e.child2=h,h.parent=e,e.aabb.combine(i.aabb,h.aabb),o.aabb.combine(e.aabb,a.aabb),e.height=1+m.max(i.height,h.height),o.height=1+m.max(e.height,a.height)):(o.child2=h,e.child2=a,a.parent=e,e.aabb.combine(i.aabb,a.aabb),o.aabb.combine(e.aabb,h.aabb),e.height=1+m.max(i.height,a.height),o.height=1+m.max(e.height,h.height)),o}if(r<-1){var c=i.child1,_=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1==e?i.parent.child1=i:i.parent.child2=i:this.m_root=i,c.height>_.height?(i.child2=c,e.child1=_,_.parent=e,e.aabb.combine(o.aabb,_.aabb),i.aabb.combine(e.aabb,c.aabb),e.height=1+m.max(o.height,_.height),i.height=1+m.max(e.height,c.height)):(i.child2=_,e.child1=c,c.parent=e,e.aabb.combine(o.aabb,c.aabb),i.aabb.combine(e.aabb,_.aabb),e.height=1+m.max(o.height,c.height),i.height=1+m.max(e.height,_.height)),i}return e},_.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},_.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,s=p.allocate().preorder(this.m_root);t=s.next();)t.height<0||(i+=t.aabb.getPerimeter());return p.release(s),i/e},_.prototype.computeHeight=function(t){var e;if((e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var i=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+m.max(i,s)},_.prototype.validateStructure=function(t){if(null!=t){t==this.m_root&&s&&n.assert(null==t.parent);var e=t.child1,i=t.child2;if(t.isLeaf())return s&&n.assert(null==e),s&&n.assert(null==i),void(s&&n.assert(0==t.height));s&&n.assert(e.parent==t),s&&n.assert(i.parent==t),this.validateStructure(e),this.validateStructure(i)}},_.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;if(t.isLeaf())return s&&n.assert(null==e),s&&n.assert(null==i),void(s&&n.assert(0==t.height));var o=e.height,r=i.height,a=1+m.max(o,r);s&&n.assert(t.height==a);var c=new h;c.combine(e.aabb,i.aabb),s&&n.assert(h.areEqual(c,t.aabb)),this.validateMetrics(e),this.validateMetrics(i)}},_.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root),s&&n.assert(this.getHeight()==this.computeHeight())},_.prototype.getMaxBalance=function(){for(var t,e=0,i=p.allocate().preorder(this.m_root);t=i.next();)if(!(t.height<=1)){s&&n.assert(0==t.isLeaf());var o=m.abs(t.child2.height-t.child1.height);e=m.max(e,o)}return p.release(i),e},_.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,s=p.allocate().preorder(this.m_root);t=s.next();)t.height<0||(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(p.release(s);i>1;){for(var o=1/0,n=-1,r=-1,a=0;a<i;++a)for(var c=e[a].aabb,_=a+1;_<i;++_){var l=e[_].aabb,u=new h;u.combine(c,l);var d=u.getPerimeter();d<o&&(n=a,r=_,o=d)}var y=e[n],f=e[r],v=this.allocateNode();v.child1=y,v.child2=f,v.height=1+m.max(y.height,f.height),v.aabb.combine(y.aabb,f.aabb),v.parent=null,y.parent=v,f.parent=v,e[r]=e[i-1],e[n]=v,--i}this.m_root=e[0],this.validate()},_.prototype.shiftOrigin=function(t){for(var e,i=p.allocate().preorder(this.m_root);e=i.next();){var s=e.aabb;s.lowerBound.x-=t.x,s.lowerBound.y-=t.y,s.upperBound.x-=t.x,s.upperBound.y-=t.y}p.release(i)},_.prototype.query=function(t,e){s&&n.assert("function"==typeof e);var i=u.allocate();for(i.push(this.m_root);i.length>0;){var o=i.pop();if(null!=o)if(h.testOverlap(o.aabb,t))if(o.isLeaf()){if(0==e(o.id))return}else i.push(o.child1),i.push(o.child2)}u.release(i)},_.prototype.rayCast=function(t,e){s&&n.assert("function"==typeof e);var i=t.p1,o=t.p2,r=a.sub(o,i);s&&n.assert(r.lengthSquared()>0),r.normalize();var c=a.cross(1,r),_=a.abs(c),p=t.maxFraction,d=new h,y=a.combine(1-p,i,p,o);d.combinePoints(i,y);var f=u.allocate(),v=l.allocate();for(f.push(this.m_root);f.length>0;){var x=f.pop();if(null!=x&&0!=h.testOverlap(x.aabb,d)){var A=x.aabb.getCenter(),g=x.aabb.getExtents();if(!(m.abs(a.dot(c,a.sub(i,A)))-a.dot(_,g)>0))if(x.isLeaf()){v.p1=a.clone(t.p1),v.p2=a.clone(t.p2),v.maxFraction=p;var b=e(v,x.id);if(0==b)return;b>0&&(p=b,y=a.combine(1-p,i,p,o),d.combinePoints(i,y))}else f.push(x.child1),f.push(x.child2)}}u.release(f),l.release(v)};var l=new r({create:function(){return{}},release:function(t){}}),u=new r({create:function(){return[]},release:function(t){t.length=0}}),p=new r({create:function(){return new d},release:function(t){t.close()}});function d(){var t=[],e=[];return{preorder:function(i){return t.length=0,t.push(i),e.length=0,e.push(0),this},next:function(){for(;t.length>0;){var i=t.length-1,s=t[i];if(0===e[i])return e[i]=1,s;if(1===e[i]&&(e[i]=2,s.child1))return t.push(s.child1),e.push(1),s.child1;if(2===e[i]&&(e[i]=3,s.child2))return t.push(s.child2),e.push(1),s.child2;t.pop(),e.pop()}},close:function(){t.length=0}}}},3229:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=function(t,e){var i=r.now();++a.toiCalls,t.state=v.e_unknown,t.t=e.tMax;var h=e.proxyA,c=e.proxyB,_=e.sweepA,y=e.sweepB;_.normalize(),y.normalize();var A=e.tMax,g=h.m_radius+c.m_radius,b=m.max(o.linearSlop,g-3*o.linearSlop),B=.25*o.linearSlop;s&&n.assert(b>B);var w=0,S=o.maxTOIIterations,C=0,M=new f,I=new p;for(I.proxyA=e.proxyA,I.proxyB=e.proxyB,I.useRadii=!1;;){var T=l.identity(),P=l.identity();_.getTransform(T,w),y.getTransform(P,w),I.transformA=T,I.transformB=P;var V=new d;if(u(V,M,I),V.distance<=0){t.state=v.e_overlapped,t.t=0;break}if(V.distance<b+B){t.state=v.e_touching,t.t=w;break}var z=new x;z.initialize(M,h,_,c,y,w);for(var E=!1,L=A,q=0;;){var F=z.findMinSeparation(L);z.indexA,z.indexB;if(F>b+B){t.state=v.e_separated,t.t=A,E=!0;break}if(F>b-B){w=L;break}var D=z.evaluate(w);z.indexA,z.indexB;if(D<b-B){t.state=v.e_failed,t.t=w,E=!0;break}if(D<=b+B){t.state=v.e_touching,t.t=w,E=!0;break}for(var R=0,k=w,j=L;;){var O;O=1&R?k+(b-D)*(j-k)/(F-D):.5*(k+j),++R,++a.toiRootIters;var G=z.evaluate(O);z.indexA,z.indexB;if(m.abs(G-b)<B){L=O;break}if(G>b?(k=O,D=G):(j=O,F=G),50==R)break}if(a.toiMaxRootIters=m.max(a.toiMaxRootIters,R),++q==o.maxPolygonVertices)break}if(++C,++a.toiIters,E)break;if(C==S){t.state=v.e_failed,t.t=w;break}}a.toiMaxIters=m.max(a.toiMaxIters,C);var U=r.diff(i);a.toiMaxTime=m.max(a.toiMaxTime,U),a.toiTime+=U},t.exports.Input=function(){this.proxyA=new y,this.proxyB=new y,this.sweepA=new _,this.sweepB=new _,this.tMax},t.exports.Output=v;var o=i(3883),n=i(1689),r=i(2084),a=i(6693),m=i(9540),h=i(5890),c=(i(3588),i(6514),i(2149),i(1146)),_=i(8804),l=i(8558),u=(i(830),i(7501),i(4735)),p=u.Input,d=u.Output,y=u.Proxy,f=u.Cache;function v(){this.state,this.t}v.e_unknown=0,v.e_failed=1,v.e_overlapped=2,v.e_touching=3,v.e_separated=4,a.toiTime=0,a.toiMaxTime=0,a.toiCalls=0,a.toiIters=0,a.toiMaxIters=0,a.toiRootIters=0,a.toiMaxRootIters=0;function x(){this.m_proxyA=new y,this.m_proxyB=new y,this.m_sweepA,this.m_sweepB,this.indexA,this.indexB,this.m_type,this.m_localPoint=h.zero(),this.m_axis=h.zero()}x.prototype.initialize=function(t,e,i,o,r,a){this.m_proxyA=e,this.m_proxyB=o;var m=t.count;s&&n.assert(0<m&&m<3),this.m_sweepA=i,this.m_sweepB=r;var _=l.identity(),u=l.identity();if(this.m_sweepA.getTransform(_,a),this.m_sweepB.getTransform(u,a),1==m){this.m_type=1;var p=this.m_proxyA.getVertex(t.indexA[0]),d=this.m_proxyB.getVertex(t.indexB[0]),y=l.mulVec2(_,p),f=l.mulVec2(u,d);return this.m_axis.setCombine(1,f,-1,y),B=this.m_axis.normalize()}if(t.indexA[0]==t.indexA[1]){this.m_type=3;var v=o.getVertex(t.indexB[0]),x=o.getVertex(t.indexB[1]);this.m_axis=h.cross(h.sub(x,v),1),this.m_axis.normalize();var A=c.mulVec2(u.q,this.m_axis);this.m_localPoint=h.mid(v,x);f=l.mulVec2(u,this.m_localPoint),p=e.getVertex(t.indexA[0]),y=l.mulVec2(_,p);return(B=h.dot(y,A)-h.dot(f,A))<0&&(this.m_axis=h.neg(this.m_axis),B=-B),B}this.m_type=2;var g=this.m_proxyA.getVertex(t.indexA[0]),b=this.m_proxyA.getVertex(t.indexA[1]);this.m_axis=h.cross(h.sub(b,g),1),this.m_axis.normalize();A=c.mulVec2(_.q,this.m_axis);this.m_localPoint=h.mid(g,b);var B;y=l.mulVec2(_,this.m_localPoint),d=this.m_proxyB.getVertex(t.indexB[0]),f=l.mulVec2(u,d);return(B=h.dot(f,A)-h.dot(y,A))<0&&(this.m_axis=h.neg(this.m_axis),B=-B),B},x.prototype.compute=function(t,e){var i=l.identity(),o=l.identity();switch(this.m_sweepA.getTransform(i,e),this.m_sweepB.getTransform(o,e),this.m_type){case 1:if(t){var r=c.mulTVec2(i.q,this.m_axis),a=c.mulTVec2(o.q,h.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(r),this.indexB=this.m_proxyB.getSupport(a)}var m=this.m_proxyA.getVertex(this.indexA),_=this.m_proxyB.getVertex(this.indexB),u=l.mulVec2(i,m),p=l.mulVec2(o,_);return h.dot(p,this.m_axis)-h.dot(u,this.m_axis);case 2:var d=c.mulVec2(i.q,this.m_axis);u=l.mulVec2(i,this.m_localPoint);if(t){a=c.mulTVec2(o.q,h.neg(d));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(a)}_=this.m_proxyB.getVertex(this.indexB),p=l.mulVec2(o,_);return h.dot(p,d)-h.dot(u,d);case 3:d=c.mulVec2(o.q,this.m_axis),p=l.mulVec2(o,this.m_localPoint);if(t){r=c.mulTVec2(i.q,h.neg(d));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(r)}m=this.m_proxyA.getVertex(this.indexA),u=l.mulVec2(i,m);return h.dot(u,d)-h.dot(p,d);default:return s&&n.assert(!1),t&&(this.indexA=-1,this.indexB=-1),0}},x.prototype.findMinSeparation=function(t){return this.compute(!0,t)},x.prototype.evaluate=function(t){return this.compute(!1,t)}},6514:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(1689),r=(i(9540),i(5890));function a(t,e,i,s){"object"==typeof t&&null!==t?(this.ex=r.clone(t),this.ey=r.clone(e)):"number"==typeof t?(this.ex=r.neo(t,i),this.ey=r.neo(e,s)):(this.ex=r.zero(),this.ey=r.zero())}a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isValid(t.ex)&&r.isValid(t.ey)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Mat22!")},a.prototype.set=function(t,e,i,s){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof s?(this.ex.set(t,i),this.ey.set(e,s)):"object"==typeof t&&"object"==typeof e?(this.ex.set(t),this.ey.set(e)):"object"==typeof t?(o&&a.assert(t),this.ex.set(t.ex),this.ey.set(t.ey)):o&&n.assert(!1)},a.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},a.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},a.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,i=this.ex.y,s=this.ey.y,o=t*s-e*i;0!=o&&(o=1/o);var n=new a;return n.ex.x=o*s,n.ey.x=-o*e,n.ex.y=-o*i,n.ey.y=o*t,n},a.prototype.solve=function(t){o&&r.assert(t);var e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,a=e*n-i*s;0!=a&&(a=1/a);var m=r.zero();return m.x=a*(n*t.x-i*t.y),m.y=a*(e*t.y-s*t.x),m},a.mul=function(t,e){if(e&&"x"in e&&"y"in e){o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)}if(e&&"ex"in e&&"ey"in e)return o&&a.assert(e),new a(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y);o&&n.assert(!1)},a.mulVec2=function(t,e){o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)},a.mulMat22=function(t,e){return o&&a.assert(e),new a(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y)},a.mulT=function(t,e){return e&&"x"in e&&"y"in e?(o&&r.assert(e),r.neo(r.dot(e,t.ex),r.dot(e,t.ey))):e&&"ex"in e&&"ey"in e?(o&&a.assert(e),new a(r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey)))):void(o&&n.assert(!1))},a.mulTVec2=function(t,e){return o&&a.assert(t),o&&r.assert(e),r.neo(r.dot(e,t.ex),r.dot(e,t.ey))},a.mulTMat22=function(t,e){return o&&a.assert(t),o&&a.assert(e),new a(r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey)))},a.abs=function(t){return o&&a.assert(t),new a(r.abs(t.ex),r.abs(t.ey))},a.add=function(t,e){return o&&a.assert(t),o&&a.assert(e),new a(r.add(t.ex,e.ex),r.add(t.ey,e.ey))}},2149:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=m;var n=i(1689),r=(i(9540),i(5890)),a=i(3588);function m(t,e,i){"object"==typeof t&&null!==t?(this.ex=a.clone(t),this.ey=a.clone(e),this.ez=a.clone(i)):(this.ex=a(),this.ey=a(),this.ez=a())}m.prototype.toString=function(){return JSON.stringify(this)},m.isValid=function(t){return t&&a.isValid(t.ex)&&a.isValid(t.ey)&&a.isValid(t.ez)},m.assert=function(t){if(o&&!m.isValid(t))throw s&&n.debug(t),new Error("Invalid Mat33!")},m.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},m.prototype.solve33=function(t){var e=a.dot(this.ex,a.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=new a;return i.x=e*a.dot(t,a.cross(this.ey,this.ez)),i.y=e*a.dot(this.ex,a.cross(t,this.ez)),i.z=e*a.dot(this.ex,a.cross(this.ey,t)),i},m.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!=n&&(n=1/n);var a=r.zero();return a.x=n*(o*t.x-i*t.y),a.y=n*(e*t.y-s*t.x),a},m.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!=n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},m.prototype.getSymInverse33=function(t){var e=a.dot(this.ex,a.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,m=this.ez.z;t.ex.x=e*(n*m-r*r),t.ex.y=e*(o*r-s*m),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*m-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)},m.mul=function(t,e){if(o&&m.assert(t),e&&"z"in e&&"y"in e&&"x"in e){o&&a.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,h=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new a(i,s,h)}if(e&&"y"in e&&"x"in e){o&&r.assert(e);i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)}o&&n.assert(!1)},m.mulVec3=function(t,e){o&&m.assert(t),o&&a.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,n=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new a(i,s,n)},m.mulVec2=function(t,e){o&&m.assert(t),o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)},m.add=function(t,e){return o&&m.assert(t),o&&m.assert(e),new m(a.add(t.ex,e.ex),a.add(t.ey,e.ey),a.add(t.ez,e.ez))}},9540:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT,n=i(1689),r=Math,a=t.exports=Object.create(r);a.EPSILON=1e-9,a.isFinite=function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},a.assert=function(t){if(o&&!a.isFinite(t))throw s&&n.debug(t),new Error("Invalid Number!")},a.invSqrt=function(t){return 1/r.sqrt(t)},a.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},a.isPowerOfTwo=function(t){return t>0&&0==(t&t-1)},a.mod=function(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)},a.clamp=function(t,e,i){return t<e?e:t>i?i:t},a.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t==e?t:r.random()*(e-t)+t}},7501:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=n;var s=i(5890),o=i(1146);function n(){this.c=s.zero(),this.a=0}n.prototype.getTransform=function(t,e){return t.q.set(this.a),t.p.set(s.sub(this.c,o.mulVec2(t.q,e))),t}},1146:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=m;var n=i(1689),r=i(5890),a=i(9540);function m(t){if(!(this instanceof m))return new m(t);"number"==typeof t?this.setAngle(t):"object"==typeof t?this.set(t):this.setIdentity()}m.neo=function(t){var e=Object.create(m.prototype);return e.setAngle(t),e},m.clone=function(t){o&&m.assert(t);var e=Object.create(m.prototype);return e.s=t.s,e.c=t.c,e},m.identity=function(){var t=Object.create(m.prototype);return t.s=0,t.c=1,t},m.isValid=function(t){return t&&a.isFinite(t.s)&&a.isFinite(t.c)},m.assert=function(t){if(o&&!m.isValid(t))throw s&&n.debug(t),new Error("Invalid Rot!")},m.prototype.setIdentity=function(){this.s=0,this.c=1},m.prototype.set=function(t){"object"==typeof t?(o&&m.assert(t),this.s=t.s,this.c=t.c):(o&&a.assert(t),this.s=a.sin(t),this.c=a.cos(t))},m.prototype.setAngle=function(t){o&&a.assert(t),this.s=a.sin(t),this.c=a.cos(t)},m.prototype.getAngle=function(){return a.atan2(this.s,this.c)},m.prototype.getXAxis=function(){return r.neo(this.c,this.s)},m.prototype.getYAxis=function(){return r.neo(-this.s,this.c)},m.mul=function(t,e){if(o&&m.assert(t),"c"in e&&"s"in e){o&&m.assert(e);var i=m.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i}if("x"in e&&"y"in e)return o&&r.assert(e),r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},m.mulRot=function(t,e){o&&m.assert(t),o&&m.assert(e);var i=m.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i},m.mulVec2=function(t,e){return o&&m.assert(t),o&&r.assert(e),r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},m.mulSub=function(t,e,i){var s=t.c*(e.x-i.x)-t.s*(e.y-i.y),o=t.s*(e.x-i.x)+t.c*(e.y-i.y);return r.neo(s,o)},m.mulT=function(t,e){if("c"in e&&"s"in e){o&&m.assert(e);var i=m.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i}if("x"in e&&"y"in e)return o&&r.assert(e),r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},m.mulTRot=function(t,e){o&&m.assert(e);var i=m.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i},m.mulTVec2=function(t,e){return o&&r.assert(e),r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}},8804:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var o=i(1689),n=i(9540),r=i(5890),a=i(1146),m=i(8558);function h(t,e){s&&o.assert(void 0===t),s&&o.assert(void 0===e),this.localCenter=r.zero(),this.c=r.zero(),this.a=0,this.alpha0=0,this.c0=r.zero(),this.a0=0}h.prototype.setTransform=function(t){var e=m.mulVec2(t,this.localCenter);this.c.set(e),this.c0.set(e),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},h.prototype.setLocalCenter=function(t,e){this.localCenter.set(t);var i=m.mulVec2(e,this.localCenter);this.c.set(i),this.c0.set(i)},h.prototype.getTransform=function(t,e){e=void 0===e?0:e,t.q.setAngle((1-e)*this.a0+e*this.a),t.p.setCombine(1-e,this.c0,e,this.c),t.p.sub(a.mulVec2(t.q,this.localCenter))},h.prototype.advance=function(t){s&&o.assert(this.alpha0<1);var e=(t-this.alpha0)/(1-this.alpha0);this.c0.setCombine(e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},h.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)},h.prototype.normalize=function(){var t=n.mod(this.a0,-n.PI,+n.PI);this.a-=this.a0-t,this.a0=t},h.prototype.clone=function(){var t=new h;return t.localCenter.set(this.localCenter),t.alpha0=this.alpha0,t.a0=this.a0,t.a=this.a,t.c0.set(this.c0),t.c.set(this.c),t},h.prototype.set=function(t){this.localCenter.set(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.set(t.c0),this.c.set(t.c)}},8558:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=m;var n=i(1689),r=i(5890),a=i(1146);function m(t,e){if(!(this instanceof m))return new m(t,e);this.p=r.zero(),this.q=a.identity(),void 0!==t&&this.p.set(t),void 0!==e&&this.q.set(e)}m.clone=function(t){var e=Object.create(m.prototype);return e.p=r.clone(t.p),e.q=a.clone(t.q),e},m.neo=function(t,e){var i=Object.create(m.prototype);return i.p=r.clone(t),i.q=a.clone(e),i},m.identity=function(){var t=Object.create(m.prototype);return t.p=r.zero(),t.q=a.identity(),t},m.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},m.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},m.isValid=function(t){return t&&r.isValid(t.p)&&a.isValid(t.q)},m.assert=function(t){if(o&&!m.isValid(t))throw s&&n.debug(t),new Error("Invalid Transform!")},m.mul=function(t,e){if(o&&m.assert(t),Array.isArray(e)){for(var i=[],s=0;s<e.length;s++)i[s]=m.mul(t,e[s]);return i}if("x"in e&&"y"in e){o&&r.assert(e);var n=t.q.c*e.x-t.q.s*e.y+t.p.x,h=t.q.s*e.x+t.q.c*e.y+t.p.y;return r.neo(n,h)}if("p"in e&&"q"in e){o&&m.assert(e);var c=m.identity();return c.q=a.mulRot(t.q,e.q),c.p=r.add(a.mulVec2(t.q,e.p),t.p),c}},m.mulAll=function(t,e){o&&m.assert(t);for(var i=[],s=0;s<e.length;s++)i[s]=m.mul(t,e[s]);return i},m.mulFn=function(t){return o&&m.assert(t),function(e){return m.mul(t,e)}},m.mulVec2=function(t,e){o&&m.assert(t),o&&r.assert(e);var i=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return r.neo(i,s)},m.mulXf=function(t,e){o&&m.assert(t),o&&m.assert(e);var i=m.identity();return i.q=a.mulRot(t.q,e.q),i.p=r.add(a.mulVec2(t.q,e.p),t.p),i},m.mulT=function(t,e){if(o&&m.assert(t),"x"in e&&"y"in e){o&&r.assert(e);var i=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*i+t.q.s*s,h=-t.q.s*i+t.q.c*s;return r.neo(n,h)}if("p"in e&&"q"in e){o&&m.assert(e);var c=m.identity();return c.q.set(a.mulTRot(t.q,e.q)),c.p.set(a.mulTVec2(t.q,r.sub(e.p,t.p))),c}},m.mulTVec2=function(t,e){o&&m.assert(t),o&&r.assert(e);var i=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*i+t.q.s*s,a=-t.q.s*i+t.q.c*s;return r.neo(n,a)},m.mulTXf=function(t,e){o&&m.assert(t),o&&m.assert(e);var i=m.identity();return i.q.set(a.mulTRot(t.q,e.q)),i.p.set(a.mulTVec2(t.q,r.sub(e.p,t.p))),i}},5890:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(1689),r=i(9540);function a(t,e){if(!(this instanceof a))return new a(t,e);void 0===t?(this.x=0,this.y=0):"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),o&&a.assert(this)}a.prototype._serialize=function(){return{x:this.x,y:this.y}},a._deserialize=function(t){var e=Object.create(a.prototype);return e.x=t.x,e.y=t.y,e},a.zero=function(){var t=Object.create(a.prototype);return t.x=0,t.y=0,t},a.neo=function(t,e){var i=Object.create(a.prototype);return i.x=t,i.y=e,i},a.clone=function(t){return o&&a.assert(t),a.neo(t.x,t.y)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isFinite(t.x)&&r.isFinite(t.y)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Vec2!")},a.prototype.clone=function(){return a.clone(this)},a.prototype.setZero=function(){return this.x=0,this.y=0,this},a.prototype.set=function(t,e){return"object"==typeof t?(o&&a.assert(t),this.x=t.x,this.y=t.y):(o&&r.assert(t),o&&r.assert(e),this.x=t,this.y=e),this},a.prototype.wSet=function(t,e,i,s){return void 0!==i||void 0!==s?this.setCombine(t,e,i,s):this.setMul(t,e)},a.prototype.setCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,m=t*e.y+i*s.y;return this.x=n,this.y=m,this},a.prototype.setMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x=i,this.y=s,this},a.prototype.add=function(t){return o&&a.assert(t),this.x+=t.x,this.y+=t.y,this},a.prototype.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?this.addCombine(t,e,i,s):this.addMul(t,e)},a.prototype.addCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,m=t*e.y+i*s.y;return this.x+=n,this.y+=m,this},a.prototype.addMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x+=i,this.y+=s,this},a.prototype.wSub=function(t,e,i,s){return void 0!==i||void 0!==s?this.subCombine(t,e,i,s):this.subMul(t,e)},a.prototype.subCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,m=t*e.y+i*s.y;return this.x-=n,this.y-=m,this},a.prototype.subMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x-=i,this.y-=s,this},a.prototype.sub=function(t){return o&&a.assert(t),this.x-=t.x,this.y-=t.y,this},a.prototype.mul=function(t){return o&&r.assert(t),this.x*=t,this.y*=t,this},a.prototype.length=function(){return a.lengthOf(this)},a.prototype.lengthSquared=function(){return a.lengthSquared(this)},a.prototype.normalize=function(){var t=this.length();if(t<r.EPSILON)return 0;var e=1/t;return this.x*=e,this.y*=e,t},a.lengthOf=function(t){return o&&a.assert(t),r.sqrt(t.x*t.x+t.y*t.y)},a.lengthSquared=function(t){return o&&a.assert(t),t.x*t.x+t.y*t.y},a.distance=function(t,e){o&&a.assert(t),o&&a.assert(e);var i=t.x-e.x,s=t.y-e.y;return r.sqrt(i*i+s*s)},a.distanceSquared=function(t,e){o&&a.assert(t),o&&a.assert(e);var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},a.areEqual=function(t,e){return o&&a.assert(t),o&&a.assert(e),t==e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},a.skew=function(t){return o&&a.assert(t),a.neo(-t.y,t.x)},a.dot=function(t,e){return o&&a.assert(t),o&&a.assert(e),t.x*e.x+t.y*e.y},a.cross=function(t,e){return"number"==typeof e?(o&&a.assert(t),o&&r.assert(e),a.neo(e*t.y,-e*t.x)):"number"==typeof t?(o&&r.assert(t),o&&a.assert(e),a.neo(-t*e.y,t*e.x)):(o&&a.assert(t),o&&a.assert(e),t.x*e.y-t.y*e.x)},a.addCross=function(t,e,i){return"number"==typeof i?(o&&a.assert(e),o&&r.assert(i),a.neo(i*e.y+t.x,-i*e.x+t.y)):"number"==typeof e?(o&&r.assert(e),o&&a.assert(i),a.neo(-e*i.y+t.x,e*i.x+t.y)):void(o&&n.assert(!1))},a.add=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(t.x+e.x,t.y+e.y)},a.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?a.combine(t,e,i,s):a.mul(t,e)},a.combine=function(t,e,i,s){return a.zero().setCombine(t,e,i,s)},a.sub=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(t.x-e.x,t.y-e.y)},a.mul=function(t,e){return"object"==typeof t?(o&&a.assert(t),o&&r.assert(e),a.neo(t.x*e,t.y*e)):"object"==typeof e?(o&&r.assert(t),o&&a.assert(e),a.neo(t*e.x,t*e.y)):void 0},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(t){return o&&a.assert(t),a.neo(-t.x,-t.y)},a.abs=function(t){return o&&a.assert(t),a.neo(r.abs(t.x),r.abs(t.y))},a.mid=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(.5*(t.x+e.x),.5*(t.y+e.y))},a.upper=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(r.max(t.x,e.x),r.max(t.y,e.y))},a.lower=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(r.min(t.x,e.x),r.min(t.y,e.y))},a.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=r.invSqrt(e);this.x*=i*t,this.y*=i*t}return this},a.clamp=function(t,e){return(t=a.neo(t.x,t.y)).clamp(e),t},a.scaleFn=function(t,e){return function(i){return a.neo(i.x*t,i.y*e)}},a.translateFn=function(t,e){return function(i){return a.neo(i.x+t,i.y+e)}}},3588:(t,e,i)=>{var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(1689),r=i(9540);function a(t,e,i){if(!(this instanceof a))return new a(t,e,i);void 0===t?(this.x=0,this.y=0,this.z=0):"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),o&&a.assert(this)}a.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},a._deserialize=function(t){var e=Object.create(a.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},a.neo=function(t,e,i){var s=Object.create(a.prototype);return s.x=t,s.y=e,s.z=i,s},a.clone=function(t){return o&&a.assert(t),a.neo(t.x,t.y,t.z)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isFinite(t.x)&&r.isFinite(t.y)&&r.isFinite(t.z)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Vec3!")},a.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},a.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},a.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},a.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},a.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},a.areEqual=function(t,e){return o&&a.assert(t),o&&a.assert(e),t==e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},a.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},a.cross=function(t,e){return new a(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},a.add=function(t,e){return new a(t.x+e.x,t.y+e.y,t.z+e.z)},a.sub=function(t,e){return new a(t.x-e.x,t.y-e.y,t.z-e.z)},a.mul=function(t,e){return new a(e*t.x,e*t.y,e*t.z)},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.neg=function(t){return new a(-t.x,-t.y,-t.z)}},830:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=function(){this.v=s.zero(),this.w=0};var s=i(5890)},6693:(t,e)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;e.toString=function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}},1793:(t,e,i)=>{i(1350),i(9540),e.Vec2=i(5890),i(3588),i(6514),i(2149),i(8558),i(1146),i(1202),i(7998),i(7176),i(5786),i(5676),i(7545),e.World=i(856),e.Circle=i(9568),e.Edge=i(2843),i(9420),i(6132),i(8055),i(6156),i(7618),i(5199),i(2976),i(5438),i(1271),i(5004),i(6658),i(3154),i(8756),i(6265),i(694),i(7941),i(1020),i(3178),i(6758),e.Settings=i(3883),i(8804),i(6693),i(5713),i(4735),i(3229),i(5326),e.Settings},1271:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var s=i(2133),o=i(3883),n=i(9540),r=i(5890),a=(i(3588),i(6514),i(2149),i(1146)),m=(i(8804),i(8558),i(830),i(7501),i(7545)),h=i(5786);_.TYPE="distance-joint",m.TYPES[_.TYPE]=_,_._super=m,_.prototype=Object.create(_._super.prototype);var c={frequencyHz:0,dampingRatio:0};function _(t,e,i,o,a){if(!(this instanceof _))return new _(t,e,i,o,a);if(i&&o&&"m_type"in o&&"x"in i&&"y"in i){var h=i;i=o,o=h}t=s(t,c),m.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=_.TYPE,this.m_localAnchorA=r.clone(o?e.getLocalPoint(o):t.localAnchorA||r.zero()),this.m_localAnchorB=r.clone(a?i.getLocalPoint(a):t.localAnchorB||r.zero()),this.m_length=n.isFinite(t.length)?t.length:r.distance(e.getWorldPoint(this.m_localAnchorA),i.getWorldPoint(this.m_localAnchorB)),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}_.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},_._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(h,t.bodyA,e),t.bodyB=i(h,t.bodyB,e),new _(t)},_.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=r.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))},_.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},_.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},_.prototype.setLength=function(t){this.m_length=t},_.prototype.getLength=function(){return this.m_length},_.prototype.setFrequency=function(t){this.m_frequencyHz=t},_.prototype.getFrequency=function(){return this.m_frequencyHz},_.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},_.prototype.getDampingRatio=function(){return this.m_dampingRatio},_.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},_.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},_.prototype.getReactionForce=function(t){return r.mul(this.m_impulse,this.m_u).mul(t)},_.prototype.getReactionTorque=function(t){return 0},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,u=a.neo(i),p=a.neo(c);this.m_rA=a.mulVec2(u,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=a.mulVec2(p,r.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=r.sub(r.add(h,this.m_rB),r.add(e,this.m_rA));var d=this.m_u.length();d>o.linearSlop?this.m_u.mul(1/d):this.m_u.set(0,0);var y=r.cross(this.m_rA,this.m_u),f=r.cross(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!=v?1/v:0,this.m_frequencyHz>0){var x=d-this.m_length,A=2*n.PI*this.m_frequencyHz,g=2*this.m_mass*this.m_dampingRatio*A,b=this.m_mass*A*A,B=t.dt;this.m_gamma=B*(g+B*b),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=x*B*b*this.m_gamma,v+=this.m_gamma,this.m_mass=0!=v?1/v:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var w=r.mul(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,w),m-=this.m_invIA*r.cross(this.m_rA,w),_.addMul(this.m_invMassB,w),l+=this.m_invIB*r.cross(this.m_rB,w)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v.set(_),this.m_bodyB.c_velocity.w=l},_.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=r.add(e,r.cross(i,this.m_rA)),a=r.add(s,r.cross(o,this.m_rB)),m=r.dot(this.m_u,a)-r.dot(this.m_u,n),h=-this.m_mass*(m+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;var c=r.mul(h,this.m_u);e.subMul(this.m_invMassA,c),i-=this.m_invIA*r.cross(this.m_rA,c),s.addMul(this.m_invMassB,c),o+=this.m_invIB*r.cross(this.m_rB,c),this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(s),this.m_bodyB.c_velocity.w=o},_.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,h=a.neo(i),c=a.neo(m),_=a.mulSub(h,this.m_localAnchorA,this.m_localCenterA),l=a.mulSub(c,this.m_localAnchorB,this.m_localCenterB),u=r.sub(r.add(s,l),r.add(e,_)),p=u.normalize()-this.m_length;p=n.clamp(p,-o.maxLinearCorrection,o.maxLinearCorrection);var d=-this.m_mass*p,y=r.mul(d,u);return e.subMul(this.m_invMassA,y),i-=this.m_invIA*r.cross(_,y),s.addMul(this.m_invMassB,y),m+=this.m_invIB*r.cross(l,y),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=m,n.abs(p)<o.linearSlop}},5004:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(1689),n=i(2133),r=(i(3883),i(9540)),a=i(5890),m=(i(3588),i(6514)),h=(i(2149),i(1146)),c=(i(8804),i(8558),i(830),i(7501),i(7545)),_=i(5786);u.TYPE="friction-joint",c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var l={maxForce:0,maxTorque:0};function u(t,e,i,s){if(!(this instanceof u))return new u(t,e,i,s);t=n(t,l),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_localAnchorA=a.clone(s?e.getLocalPoint(s):t.localAnchorA||a.zero()),this.m_localAnchorB=a.clone(s?i.getLocalPoint(s):t.localAnchorB||a.zero()),this.m_linearImpulse=a.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(_,t.bodyA,e),t.bodyB=i(_,t.bodyB,e),new u(t)},u.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},u.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},u.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},u.prototype.setMaxForce=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxForce=t},u.prototype.getMaxForce=function(){return this.m_maxForce},u.prototype.setMaxTorque=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxTorque=t},u.prototype.getMaxTorque=function(){return this.m_maxTorque},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return a.mul(t,this.m_linearImpulse)},u.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,c=h.neo(e),_=h.neo(o);this.m_rA=h.mulVec2(c,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=h.mulVec2(_,a.sub(this.m_localAnchorB,this.m_localCenterB));var l=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,d=this.m_invIB,y=new m;if(y.ex.x=l+u+p*this.m_rA.y*this.m_rA.y+d*this.m_rB.y*this.m_rB.y,y.ex.y=-p*this.m_rA.x*this.m_rA.y-d*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=l+u+p*this.m_rA.x*this.m_rA.x+d*this.m_rB.x*this.m_rB.x,this.m_linearMass=y.getInverse(),this.m_angularMass=p+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var f=a.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(l,f),s-=p*(a.cross(this.m_rA,f)+this.m_angularImpulse),n.addMul(u,f),r+=d*(a.cross(this.m_rB,f)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,h=this.m_invMassB,c=this.m_invIA,_=this.m_invIB,l=t.dt,u=o-i,p=-this.m_angularMass*u,d=this.m_angularImpulse,y=l*this.m_maxTorque;this.m_angularImpulse=r.clamp(this.m_angularImpulse+p,-y,y),i-=c*(p=this.m_angularImpulse-d),o+=_*p;u=a.sub(a.add(s,a.cross(o,this.m_rB)),a.add(e,a.cross(i,this.m_rA))),p=a.neg(m.mulVec2(this.m_linearMass,u)),d=this.m_linearImpulse;this.m_linearImpulse.add(p);y=l*this.m_maxForce;this.m_linearImpulse.lengthSquared()>y*y&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(y)),p=a.sub(this.m_linearImpulse,d),e.subMul(n,p),i-=c*a.cross(this.m_rA,p),s.addMul(h,p),o+=_*a.cross(this.m_rB,p),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){return!0}},6658:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=d;var o=i(1689),n=i(2133),r=i(3883),a=i(9540),m=i(5890),h=(i(3588),i(6514),i(2149),i(1146)),c=(i(8804),i(8558),i(830),i(7501),i(7545)),_=i(5786),l=i(7941),u=i(6265);d.TYPE="gear-joint",c.TYPES[d.TYPE]=d,d._super=c,d.prototype=Object.create(d._super.prototype);var p={ratio:1};function d(t,e,i,r,_,y){if(!(this instanceof d))return new d(t,e,i,r,_,y);var f,v;t=n(t,p),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=d.TYPE,s&&o.assert(r.m_type===l.TYPE||r.m_type===u.TYPE),s&&o.assert(_.m_type===l.TYPE||_.m_type===u.TYPE),this.m_joint1=r||t.joint1,this.m_joint2=_||t.joint2,this.m_ratio=a.isFinite(y)?y:t.ratio,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType(),this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var x=this.m_bodyA.m_xf,A=this.m_bodyA.m_sweep.a,g=this.m_bodyC.m_xf,b=this.m_bodyC.m_sweep.a;if(this.m_type1===l.TYPE){var B=this.m_joint1;this.m_localAnchorC=B.m_localAnchorA,this.m_localAnchorA=B.m_localAnchorB,this.m_referenceAngleA=B.m_referenceAngle,this.m_localAxisC=m.zero(),f=A-b-this.m_referenceAngleA}else{var w=this.m_joint1;this.m_localAnchorC=w.m_localAnchorA,this.m_localAnchorA=w.m_localAnchorB,this.m_referenceAngleA=w.m_referenceAngle,this.m_localAxisC=w.m_localXAxisA;var S=this.m_localAnchorC,C=h.mulTVec2(g.q,m.add(h.mul(x.q,this.m_localAnchorA),m.sub(x.p,g.p)));f=m.dot(C,this.m_localAxisC)-m.dot(S,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var M=this.m_bodyB.m_xf,I=this.m_bodyB.m_sweep.a,T=this.m_bodyD.m_xf,P=this.m_bodyD.m_sweep.a;if(this.m_type2===l.TYPE){B=this.m_joint2;this.m_localAnchorD=B.m_localAnchorA,this.m_localAnchorB=B.m_localAnchorB,this.m_referenceAngleB=B.m_referenceAngle,this.m_localAxisD=m.zero(),v=I-P-this.m_referenceAngleB}else{w=this.m_joint2;this.m_localAnchorD=w.m_localAnchorA,this.m_localAnchorB=w.m_localAnchorB,this.m_referenceAngleB=w.m_referenceAngle,this.m_localAxisD=w.m_localXAxisA;var V=this.m_localAnchorD,z=h.mulTVec2(T.q,m.add(h.mul(M.q,this.m_localAnchorB),m.sub(M.p,T.p)));v=m.dot(z,this.m_localAxisD)-m.dot(V,this.m_localAxisD)}this.m_constant=f+this.m_ratio*v,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}d.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},d._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(_,t.bodyA,e),t.bodyB=i(_,t.bodyB,e),t.joint1=i(c,t.joint1,e),t.joint2=i(c,t.joint2,e),new d(t)},d.prototype.getJoint1=function(){return this.m_joint1},d.prototype.getJoint2=function(){return this.m_joint2},d.prototype.setRatio=function(t){s&&o.assert(a.isFinite(t)),this.m_ratio=t},d.prototype.getRatio=function(){return this.m_ratio},d.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},d.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},d.prototype.getReactionForce=function(t){return m.mul(this.m_impulse,this.m_JvAC).mul(t)},d.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},d.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_position.a,c=this.m_bodyC.c_velocity.v,_=this.m_bodyC.c_velocity.w,u=this.m_bodyD.c_position.a,p=this.m_bodyD.c_velocity.v,d=this.m_bodyD.c_velocity.w,y=h.neo(e),f=h.neo(o),v=h.neo(a),x=h.neo(u);if(this.m_mass=0,this.m_type1==l.TYPE)this.m_JvAC=m.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var A=h.mulVec2(v,this.m_localAxisC),g=h.mulSub(v,this.m_localAnchorC,this.m_lcC),b=h.mulSub(y,this.m_localAnchorA,this.m_lcA);this.m_JvAC=A,this.m_JwC=m.cross(g,A),this.m_JwA=m.cross(b,A),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==l.TYPE)this.m_JvBD=m.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{A=h.mulVec2(x,this.m_localAxisD);var B=h.mulSub(x,this.m_localAnchorD,this.m_lcD),w=h.mulSub(f,this.m_localAnchorB,this.m_lcB);this.m_JvBD=m.mul(this.m_ratio,A),this.m_JwD=this.m_ratio*m.cross(B,A),this.m_JwB=this.m_ratio*m.cross(w,A),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,c.subMul(this.m_mC*this.m_impulse,this.m_JvAC),_-=this.m_iC*this.m_impulse*this.m_JwC,p.subMul(this.m_mD*this.m_impulse,this.m_JvBD),d-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.set(c),this.m_bodyC.c_velocity.w=_,this.m_bodyD.c_velocity.v.set(p),this.m_bodyD.c_velocity.w=d},d.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,a=this.m_bodyD.c_velocity.v,h=this.m_bodyD.c_velocity.w,c=m.dot(this.m_JvAC,e)-m.dot(this.m_JvAC,n)+m.dot(this.m_JvBD,s)-m.dot(this.m_JvBD,a);c+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*o-this.m_JwD*h);var _=-this.m_mass*c;this.m_impulse+=_,e.addMul(this.m_mA*_,this.m_JvAC),i+=this.m_iA*_*this.m_JwA,s.addMul(this.m_mB*_,this.m_JvBD),o+=this.m_iB*_*this.m_JwB,n.subMul(this.m_mC*_,this.m_JvAC),r-=this.m_iC*_*this.m_JwC,a.subMul(this.m_mD*_,this.m_JvBD),h-=this.m_iD*_*this.m_JwD,this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(s),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.set(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.set(a),this.m_bodyD.c_velocity.w=h},d.prototype.solvePositionConstraints=function(t){var e,i,s,o,n,a,c,_,u=this.m_bodyA.c_position.c,p=this.m_bodyA.c_position.a,d=this.m_bodyB.c_position.c,y=this.m_bodyB.c_position.a,f=this.m_bodyC.c_position.c,v=this.m_bodyC.c_position.a,x=this.m_bodyD.c_position.c,A=this.m_bodyD.c_position.a,g=h.neo(p),b=h.neo(y),B=h.neo(v),w=h.neo(A),S=0;if(this.m_type1==l.TYPE)s=m.zero(),n=1,c=1,S+=this.m_iA+this.m_iC,e=p-v-this.m_referenceAngleA;else{var C=h.mulVec2(B,this.m_localAxisC),M=h.mulSub(B,this.m_localAnchorC,this.m_lcC),I=h.mulSub(g,this.m_localAnchorA,this.m_lcA);s=C,c=m.cross(M,C),n=m.cross(I,C),S+=this.m_mC+this.m_mA+this.m_iC*c*c+this.m_iA*n*n;var T=m.sub(this.m_localAnchorC,this.m_lcC),P=h.mulTVec2(B,m.add(I,m.sub(u,f)));e=m.dot(m.sub(P,T),this.m_localAxisC)}if(this.m_type2==l.TYPE)o=m.zero(),a=this.m_ratio,_=this.m_ratio,S+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=y-A-this.m_referenceAngleB;else{C=h.mulVec2(w,this.m_localAxisD);var V=h.mulSub(w,this.m_localAnchorD,this.m_lcD),z=h.mulSub(b,this.m_localAnchorB,this.m_lcB);o=m.mul(this.m_ratio,C),_=this.m_ratio*m.cross(V,C),a=this.m_ratio*m.cross(z,C),S+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*_*_+this.m_iB*a*a;var E=m.sub(this.m_localAnchorD,this.m_lcD),L=h.mulTVec2(w,m.add(z,m.sub(d,x)));i=m.dot(L,this.m_localAxisD)-m.dot(E,this.m_localAxisD)}var q=e+this.m_ratio*i-this.m_constant,F=0;return S>0&&(F=-q/S),u.addMul(this.m_mA*F,s),p+=this.m_iA*F*n,d.addMul(this.m_mB*F,o),y+=this.m_iB*F*a,f.subMul(this.m_mC*F,s),v-=this.m_iC*F*c,x.subMul(this.m_mD*F,o),A-=this.m_iD*F*_,this.m_bodyA.c_position.c.set(u),this.m_bodyA.c_position.a=p,this.m_bodyB.c_position.c.set(d),this.m_bodyB.c_position.a=y,this.m_bodyC.c_position.c.set(f),this.m_bodyC.c_position.a=v,this.m_bodyD.c_position.c.set(x),this.m_bodyD.c_position.a=A,0<r.linearSlop}},3154:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(1689),n=i(2133),r=(i(3883),i(9540)),a=i(5890),m=(i(3588),i(6514)),h=(i(2149),i(1146)),c=(i(8804),i(8558),i(830),i(7501),i(7545)),_=i(5786);u.TYPE="motor-joint",c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var l={maxForce:1,maxTorque:1,correctionFactor:.3};function u(t,e,i){if(!(this instanceof u))return new u(t,e,i);t=n(t,l),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_linearOffset=r.isFinite(t.linearOffset)?t.linearOffset:e.getLocalPoint(i.getPosition()),this.m_angularOffset=r.isFinite(t.angularOffset)?t.angularOffset:i.getAngle()-e.getAngle(),this.m_linearImpulse=a.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(_,t.bodyA,e),t.bodyB=i(_,t.bodyB,e),new u(t)},u.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},u.prototype.setMaxForce=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxForce=t},u.prototype.getMaxForce=function(){return this.m_maxForce},u.prototype.setMaxTorque=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxTorque=t},u.prototype.getMaxTorque=function(){return this.m_maxTorque},u.prototype.setCorrectionFactor=function(t){s&&o.assert(r.isFinite(t)&&0<=t&&t<=1),this.m_correctionFactor=t},u.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},u.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)},u.prototype.getLinearOffset=function(){return this.m_linearOffset},u.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},u.prototype.getAngularOffset=function(){return this.m_angularOffset},u.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},u.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},u.prototype.getReactionForce=function(t){return a.mul(t,this.m_linearImpulse)},u.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,l=h.neo(i),u=h.neo(r);this.m_rA=h.mulVec2(l,a.neg(this.m_localCenterA)),this.m_rB=h.mulVec2(u,a.neg(this.m_localCenterB));var p=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,v=new m;if(v.ex.x=p+d+y*this.m_rA.y*this.m_rA.y+f*this.m_rB.y*this.m_rB.y,v.ex.y=-y*this.m_rA.x*this.m_rA.y-f*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=p+d+y*this.m_rA.x*this.m_rA.x+f*this.m_rB.x*this.m_rB.x,this.m_linearMass=v.getInverse(),this.m_angularMass=y+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=a.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_linearError.sub(h.mulVec2(l,this.m_linearOffset)),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var x=a.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(p,x),o-=y*(a.cross(this.m_rA,x)+this.m_angularImpulse),c.addMul(d,x),_+=f*(a.cross(this.m_rB,x)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=_},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,h=this.m_invMassB,c=this.m_invIA,_=this.m_invIB,l=t.dt,u=t.inv_dt,p=o-i+u*this.m_correctionFactor*this.m_angularError,d=-this.m_angularMass*p,y=this.m_angularImpulse,f=l*this.m_maxTorque;this.m_angularImpulse=r.clamp(this.m_angularImpulse+d,-f,f),i-=c*(d=this.m_angularImpulse-y),o+=_*d,(p=a.zero()).addCombine(1,s,1,a.cross(o,this.m_rB)),p.subCombine(1,e,1,a.cross(i,this.m_rA)),p.addMul(u*this.m_correctionFactor,this.m_linearError);d=a.neg(m.mulVec2(this.m_linearMass,p)),y=a.clone(this.m_linearImpulse);this.m_linearImpulse.add(d);f=l*this.m_maxForce;this.m_linearImpulse.clamp(f),d=a.sub(this.m_linearImpulse,y),e.subMul(n,d),i-=c*a.cross(this.m_rA,d),s.addMul(h,d),o+=_*a.cross(this.m_rB,d),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){return!0}},8756:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=p;var o=i(1689),n=i(2133),r=i(9540),a=i(5890),m=(i(3588),i(6514)),h=(i(2149),i(1146)),c=(i(8804),i(8558)),_=(i(830),i(7501),i(7545)),l=i(5786);p.TYPE="mouse-joint",_.TYPES[p.TYPE]=p,p._super=_,p.prototype=Object.create(p._super.prototype);var u={maxForce:0,frequencyHz:5,dampingRatio:.7};function p(t,e,i,h){if(!(this instanceof p))return new p(t,e,i,h);t=n(t,u),_.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=p.TYPE,s&&o.assert(r.isFinite(t.maxForce)&&t.maxForce>=0),s&&o.assert(r.isFinite(t.frequencyHz)&&t.frequencyHz>=0),s&&o.assert(r.isFinite(t.dampingRatio)&&t.dampingRatio>=0),this.m_targetA=h?a.clone(h):t.target||a.zero(),this.m_localAnchorB=c.mulTVec2(i.getTransform(),this.m_targetA),this.m_maxForce=t.maxForce,this.m_impulse=a.zero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=a.zero(),this.m_localCenterB=a.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new m,this.m_C=a.zero()}p.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},p._deserialize=function(t,e,i){(t=Object.assign({},t)).bodyA=i(l,t.bodyA,e),t.bodyB=i(l,t.bodyB,e),t.target=a(t.target);var s=new p(t);return t._localAnchorB&&(s.m_localAnchorB=t._localAnchorB),s},p.prototype.setTarget=function(t){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=a.clone(t)},p.prototype.getTarget=function(){return this.m_targetA},p.prototype.setMaxForce=function(t){this.m_maxForce=t},p.getMaxForce=function(){return this.m_maxForce},p.prototype.setFrequency=function(t){this.m_frequencyHz=t},p.prototype.getFrequency=function(){return this.m_frequencyHz},p.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},p.prototype.getDampingRatio=function(){return this.m_dampingRatio},p.prototype.getAnchorA=function(){return a.clone(this.m_targetA)},p.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},p.prototype.getReactionForce=function(t){return a.mul(t,this.m_impulse)},p.prototype.getReactionTorque=function(t){return 0*t},p.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},p.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,n=e.c,c=e.a,_=i.v,l=i.w,u=h.neo(c),p=this.m_bodyB.getMass(),d=2*r.PI*this.m_frequencyHz,y=2*p*this.m_dampingRatio*d,f=p*(d*d),v=t.dt;s&&o.assert(y+v*f>r.EPSILON),this.m_gamma=v*(y+v*f),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=v*f*this.m_gamma,this.m_rB=h.mulVec2(u,a.sub(this.m_localAnchorB,this.m_localCenterB));var x=new m;x.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,x.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,x.ey.x=x.ex.y,x.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=x.getInverse(),this.m_C.set(n),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),l*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),_.addMul(this.m_invMassB,this.m_impulse),l+=this.m_invIB*a.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.set(_),i.w=l},p.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=a.clone(e.v),s=e.w,o=a.cross(s,this.m_rB);o.add(i),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();var n=m.mulVec2(this.m_mass,o),r=a.clone(this.m_impulse);this.m_impulse.add(n);var h=t.dt*this.m_maxForce;this.m_impulse.clamp(h),n=a.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),s+=this.m_invIB*a.cross(this.m_rB,n),e.v.set(i),e.w=s},p.prototype.solvePositionConstraints=function(t){return!0}},6265:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=f;var o=i(1689),n=i(2133),r=i(3883),a=i(9540),m=i(5890),h=i(3588),c=i(6514),_=i(2149),l=i(1146),u=(i(8804),i(8558),i(830),i(7501),i(7545)),p=i(5786),d=0;f.TYPE="prismatic-joint",u.TYPES[f.TYPE]=f,f._super=u,f.prototype=Object.create(f._super.prototype);var y={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function f(t,e,i,s,o){if(!(this instanceof f))return new f(t,e,i,s,o);t=n(t,y),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=f.TYPE,this.m_localAnchorA=m.clone(s?e.getLocalPoint(s):t.localAnchorA||m.zero()),this.m_localAnchorB=m.clone(s?i.getLocalPoint(s):t.localAnchorB||m.zero()),this.m_localXAxisA=m.clone(o?e.getLocalVector(o):t.localAxisA||m.neo(1,0)),this.m_localXAxisA.normalize(),this.m_localYAxisA=m.cross(1,this.m_localXAxisA),this.m_referenceAngle=a.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=h(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=d,this.m_axis=m.zero(),this.m_perp=m.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new _,this.m_motorMass}f.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},f._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(p,t.bodyA,e),t.bodyB=i(p,t.bodyB,e),t.localAxisA=m(t.localAxisA),new f(t)},f.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.set(t.localAxisA),this.m_localYAxisA.set(m.cross(1,t.localAxisA)))},f.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.getLocalAxisA=function(){return this.m_localXAxisA},f.prototype.getReferenceAngle=function(){return this.m_referenceAngle},f.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=m.sub(e,t),s=this.m_bodyA.getWorldVector(this.m_localXAxisA);return m.dot(i,s)},f.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=l.mulVec2(t.m_xf.q,m.sub(this.m_localAnchorA,t.m_sweep.localCenter)),s=l.mulVec2(e.m_xf.q,m.sub(this.m_localAnchorB,e.m_sweep.localCenter)),o=m.add(t.m_sweep.c,i),n=m.add(e.m_sweep.c,s),r=m.sub(n,o),a=l.mulVec2(t.m_xf.q,this.m_localXAxisA),h=t.m_linearVelocity,c=e.m_linearVelocity,_=t.m_angularVelocity,u=e.m_angularVelocity;return m.dot(r,m.cross(_,a))+m.dot(a,m.sub(m.addCross(c,u,s),m.addCross(h,_,i)))},f.prototype.isLimitEnabled=function(){return this.m_enableLimit},f.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},f.prototype.getLowerLimit=function(){return this.m_lowerTranslation},f.prototype.getUpperLimit=function(){return this.m_upperTranslation},f.prototype.setLimits=function(t,e){s&&o.assert(t<=e),t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},f.prototype.isMotorEnabled=function(){return this.m_enableMotor},f.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},f.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},f.prototype.setMaxMotorForce=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},f.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},f.prototype.getMotorSpeed=function(){return this.m_motorSpeed},f.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},f.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(t){return m.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},f.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},f.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,u=l.neo(i),p=l.neo(h),y=l.mulVec2(u,m.sub(this.m_localAnchorA,this.m_localCenterA)),f=l.mulVec2(p,m.sub(this.m_localAnchorB,this.m_localCenterB)),v=m.zero();v.addCombine(1,n,1,f),v.subCombine(1,e,1,y);var x=this.m_invMassA,A=this.m_invMassB,g=this.m_invIA,b=this.m_invIB;this.m_axis=l.mulVec2(u,this.m_localXAxisA),this.m_a1=m.cross(m.add(v,y),this.m_axis),this.m_a2=m.cross(f,this.m_axis),this.m_motorMass=x+A+g*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=l.mulVec2(u,this.m_localYAxisA),this.m_s1=m.cross(m.add(v,y),this.m_perp),this.m_s2=m.cross(f,this.m_perp);m.cross(y,this.m_perp);var B=x+A+g*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,w=g*this.m_s1+b*this.m_s2,S=g*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,C=g+b;0==C&&(C=1);var M=g*this.m_a1+b*this.m_a2,I=x+A+g*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_K.ex.set(B,w,S),this.m_K.ey.set(w,C,M),this.m_K.ez.set(S,M,I),this.m_enableLimit){var T=m.dot(this.m_axis,v);a.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.linearSlop?this.m_limitState=3:T<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):T>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=d,this.m_impulse.z=0)}else this.m_limitState=d,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var P=m.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),V=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,z=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.subMul(x,P),o-=g*V,c.addMul(A,P),_+=b*z}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(c),this.m_bodyB.c_velocity.w=_},f.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,_=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var l=m.dot(this.m_axis,m.sub(s,e))+this.m_a2*o-this.m_a1*i,u=this.m_motorMass*(this.m_motorSpeed-l),p=this.m_motorImpulse,y=t.dt*this.m_maxMotorForce;this.m_motorImpulse=a.clamp(this.m_motorImpulse+u,-y,y),u=this.m_motorImpulse-p;var f=m.mul(u,this.m_axis),v=u*this.m_a1,x=u*this.m_a2;e.subMul(n,f),i-=c*v,s.addMul(r,f),o+=_*x}var A=m.zero();if(A.x+=m.dot(this.m_perp,s)+this.m_s2*o,A.x-=m.dot(this.m_perp,e)+this.m_s1*i,A.y=o-i,this.m_enableLimit&&this.m_limitState!=d){var g=0;g+=m.dot(this.m_axis,s)+this.m_a2*o,g-=m.dot(this.m_axis,e)+this.m_a1*i;l=h(A.x,A.y,g);var b=h(this.m_impulse),B=this.m_K.solve33(h.neg(l));this.m_impulse.add(B),1==this.m_limitState?this.m_impulse.z=a.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=a.min(this.m_impulse.z,0));var w=m.combine(-1,A,-(this.m_impulse.z-b.z),m.neo(this.m_K.ez.x,this.m_K.ez.y)),S=m.add(this.m_K.solve22(w),m.neo(b.x,b.y));this.m_impulse.x=S.x,this.m_impulse.y=S.y,B=h.sub(this.m_impulse,b);f=m.combine(B.x,this.m_perp,B.z,this.m_axis),v=B.x*this.m_s1+B.y+B.z*this.m_a1,x=B.x*this.m_s2+B.y+B.z*this.m_a2;e.subMul(n,f),i-=c*v,s.addMul(r,f),o+=_*x}else{B=this.m_K.solve22(m.neg(A));this.m_impulse.x+=B.x,this.m_impulse.y+=B.y;f=m.mul(B.x,this.m_perp),v=B.x*this.m_s1+B.y,x=B.x*this.m_s2+B.y;e.subMul(n,f),i-=c*v,s.addMul(r,f),o+=_*x}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},f.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=l.neo(i),u=l.neo(o),p=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,v=l.mulVec2(n,m.sub(this.m_localAnchorA,this.m_localCenterA)),x=l.mulVec2(u,m.sub(this.m_localAnchorB,this.m_localCenterB)),A=m.sub(m.add(s,x),m.add(e,v)),g=l.mulVec2(n,this.m_localXAxisA),b=m.cross(m.add(A,v),g),B=m.cross(x,g),w=l.mulVec2(n,this.m_localYAxisA),S=m.cross(m.add(A,v),w),C=m.cross(x,w),M=h(),I=m.zero();I.x=m.dot(w,A),I.y=o-i-this.m_referenceAngle;var T=a.abs(I.x),P=a.abs(I.y),V=r.linearSlop,z=r.maxLinearCorrection,E=!1,L=0;if(this.m_enableLimit){var q=m.dot(g,A);a.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*V?(L=a.clamp(q,-z,z),T=a.max(T,a.abs(q)),E=!0):q<=this.m_lowerTranslation?(L=a.clamp(q-this.m_lowerTranslation+V,-z,0),T=a.max(T,this.m_lowerTranslation-q),E=!0):q>=this.m_upperTranslation&&(L=a.clamp(q-this.m_upperTranslation-V,0,z),T=a.max(T,q-this.m_upperTranslation),E=!0)}if(E){var F=p+d+y*S*S+f*C*C,D=y*S+f*C,R=y*S*b+f*C*B;0==(G=y+f)&&(G=1);var k=y*b+f*B,j=p+d+y*b*b+f*B*B;(U=new _).ex.set(F,D,R),U.ey.set(D,G,k),U.ez.set(R,k,j);var O=h();O.x=I.x,O.y=I.y,O.z=L,M=U.solve33(h.neg(O))}else{var G,U;F=p+d+y*S*S+f*C*C,D=y*S+f*C;0==(G=y+f)&&(G=1),(U=new c).ex.set(F,D),U.ey.set(D,G);var Y=U.solve(m.neg(I));M.x=Y.x,M.y=Y.y,M.z=0}var N=m.combine(M.x,w,M.z,g),W=M.x*S+M.y+M.z*b,J=M.x*C+M.y+M.z*B;return e.subMul(p,N),i-=y*W,s.addMul(d,N),o+=f*J,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,T<=r.linearSlop&&P<=r.angularSlop}},694:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(1689),n=i(2133),r=i(3883),a=i(9540),m=i(5890),h=(i(3588),i(6514),i(2149),i(1146)),c=(i(8804),i(8558),i(830),i(7501),i(7545)),_=i(5786);u.TYPE="pulley-joint",u.MIN_PULLEY_LENGTH=2,c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var l={collideConnected:!0};function u(t,e,i,r,h,_,p,d){if(!(this instanceof u))return new u(t,e,i,r,h,_,p,d);t=n(t,l),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_groundAnchorA=r||(t.groundAnchorA||m.neo(-1,1)),this.m_groundAnchorB=h||(t.groundAnchorB||m.neo(1,1)),this.m_localAnchorA=_?e.getLocalPoint(_):t.localAnchorA||m.neo(-1,0),this.m_localAnchorB=p?i.getLocalPoint(p):t.localAnchorB||m.neo(1,0),this.m_lengthA=a.isFinite(t.lengthA)?t.lengthA:m.distance(_,r),this.m_lengthB=a.isFinite(t.lengthB)?t.lengthB:m.distance(p,h),this.m_ratio=a.isFinite(d)?d:t.ratio,s&&o.assert(d>a.EPSILON),this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(_,t.bodyA,e),t.bodyB=i(_,t.bodyB,e),new u(t)},u.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},u.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},u.prototype.getLengthA=function(){return this.m_lengthA},u.prototype.getLengthB=function(){return this.m_lengthB},u.prototype.getRatio=function(){return this.m_ratio},u.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return m.distance(t,e)},u.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return m.distance(t,e)},u.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return m.mul(this.m_impulse,this.m_uB).mul(t)},u.prototype.getReactionTorque=function(t){return 0},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,l=h.neo(i),u=h.neo(a);this.m_rA=h.mulVec2(l,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=h.mulVec2(u,m.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=m.sub(m.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=m.sub(m.add(n,this.m_rB),this.m_groundAnchorB);var p=this.m_uA.length(),d=this.m_uB.length();p>10*r.linearSlop?this.m_uA.mul(1/p):this.m_uA.setZero(),d>10*r.linearSlop?this.m_uB.mul(1/d):this.m_uB.setZero();var y=m.cross(this.m_rA,this.m_uA),f=m.cross(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*y*y,x=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=v+this.m_ratio*this.m_ratio*x,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var A=m.mul(-this.m_impulse,this.m_uA),g=m.mul(-this.m_ratio*this.m_impulse,this.m_uB);s.addMul(this.m_invMassA,A),o+=this.m_invIA*m.cross(this.m_rA,A),c.addMul(this.m_invMassB,g),_+=this.m_invIB*m.cross(this.m_rB,g)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=_},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=m.add(e,m.cross(i,this.m_rA)),r=m.add(s,m.cross(o,this.m_rB)),a=-m.dot(this.m_uA,n)-this.m_ratio*m.dot(this.m_uB,r),h=-this.m_mass*a;this.m_impulse+=h;var c=m.mul(-h,this.m_uA),_=m.mul(-this.m_ratio*h,this.m_uB);e.addMul(this.m_invMassA,c),i+=this.m_invIA*m.cross(this.m_rA,c),s.addMul(this.m_invMassB,_),o+=this.m_invIB*m.cross(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=h.neo(i),c=h.neo(o),_=h.mulVec2(n,m.sub(this.m_localAnchorA,this.m_localCenterA)),l=h.mulVec2(c,m.sub(this.m_localAnchorB,this.m_localCenterB)),u=m.sub(m.add(e,this.m_rA),this.m_groundAnchorA),p=m.sub(m.add(s,this.m_rB),this.m_groundAnchorB),d=u.length(),y=p.length();d>10*r.linearSlop?u.mul(1/d):u.setZero(),y>10*r.linearSlop?p.mul(1/y):p.setZero();var f=m.cross(_,u),v=m.cross(l,p),x=this.m_invMassA+this.m_invIA*f*f,A=this.m_invMassB+this.m_invIB*v*v,g=x+this.m_ratio*this.m_ratio*A;g>0&&(g=1/g);var b=this.m_constant-d-this.m_ratio*y,B=a.abs(b),w=-g*b,S=m.mul(-w,u),C=m.mul(-this.m_ratio*w,p);return e.addMul(this.m_invMassA,S),i+=this.m_invIA*m.cross(_,S),s.addMul(this.m_invMassB,C),o+=this.m_invIB*m.cross(l,C),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,B<r.linearSlop}},7941:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=f;var o=i(1689),n=i(2133),r=i(3883),a=i(9540),m=i(5890),h=i(3588),c=i(6514),_=i(2149),l=i(1146),u=(i(8804),i(8558),i(830),i(7501),i(7545)),p=i(5786),d=0;f.TYPE="revolute-joint",u.TYPES[f.TYPE]=f,f._super=u,f.prototype=Object.create(f._super.prototype);var y={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function f(t,e,i,s){if(!(this instanceof f))return new f(t,e,i,s);t=n(t,y),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=f.TYPE,this.m_localAnchorA=m.clone(s?e.getLocalPoint(s):t.localAnchorA||m.zero()),this.m_localAnchorB=m.clone(s?i.getLocalPoint(s):t.localAnchorB||m.zero()),this.m_referenceAngle=a.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=h(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new _,this.m_motorMass,this.m_limitState=d}f.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},f._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(p,t.bodyA,e),t.bodyB=i(p,t.bodyB,e),new f(t)},f.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},f.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.getReferenceAngle=function(){return this.m_referenceAngle},f.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},f.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},f.prototype.isMotorEnabled=function(){return this.m_enableMotor},f.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},f.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},f.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},f.prototype.getMotorSpeed=function(){return this.m_motorSpeed},f.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},f.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},f.prototype.isLimitEnabled=function(){return this.m_enableLimit},f.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},f.prototype.getLowerLimit=function(){return this.m_lowerAngle},f.prototype.getUpperLimit=function(){return this.m_upperAngle},f.prototype.setLimits=function(t,e){s&&o.assert(t<=e),t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},f.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(t){return m.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},f.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},f.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,c=l.neo(e),_=l.neo(o);this.m_rA=l.mulVec2(c,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=l.mulVec2(_,m.sub(this.m_localAnchorB,this.m_localCenterB));var u=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,v=y+f===0;if(this.m_mass.ex.x=u+p+this.m_rA.y*this.m_rA.y*y+this.m_rB.y*this.m_rB.y*f,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*y-this.m_rB.y*this.m_rB.x*f,this.m_mass.ez.x=-this.m_rA.y*y-this.m_rB.y*f,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=u+p+this.m_rA.x*this.m_rA.x*y+this.m_rB.x*this.m_rB.x*f,this.m_mass.ez.y=this.m_rA.x*y+this.m_rB.x*f,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=y+f,this.m_motorMass=y+f,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||v)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==v){var x=o-e-this.m_referenceAngle;a.abs(this.m_upperAngle-this.m_lowerAngle)<2*r.angularSlop?this.m_limitState=3:x<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):x>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=d,this.m_impulse.z=0)}else this.m_limitState=d;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var A=m.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(u,A),s-=y*(m.cross(this.m_rA,A)+this.m_motorImpulse+this.m_impulse.z),n.addMul(p,A),h+=f*(m.cross(this.m_rB,A)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=h},f.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,_=this.m_invIB,l=c+_===0;if(this.m_enableMotor&&3!=this.m_limitState&&0==l){var u=o-i-this.m_motorSpeed,p=-this.m_motorMass*u,y=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=a.clamp(this.m_motorImpulse+p,-f,f),i-=c*(p=this.m_motorImpulse-y),o+=_*p}if(this.m_enableLimit&&this.m_limitState!=d&&0==l){var v=m.zero();v.addCombine(1,s,1,m.cross(o,this.m_rB)),v.subCombine(1,e,1,m.cross(i,this.m_rA));var x=o-i;u=h(v.x,v.y,x),p=h.neg(this.m_mass.solve33(u));if(3==this.m_limitState)this.m_impulse.add(p);else if(1==this.m_limitState){if(this.m_impulse.z+p.z<0){var A=m.combine(-1,v,this.m_impulse.z,m.neo(this.m_mass.ez.x,this.m_mass.ez.y)),g=this.m_mass.solve22(A);p.x=g.x,p.y=g.y,p.z=-this.m_impulse.z,this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,this.m_impulse.z=0}else this.m_impulse.add(p)}else if(2==this.m_limitState){if(this.m_impulse.z+p.z>0){A=m.combine(-1,v,this.m_impulse.z,m.neo(this.m_mass.ez.x,this.m_mass.ez.y)),g=this.m_mass.solve22(A);p.x=g.x,p.y=g.y,p.z=-this.m_impulse.z,this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,this.m_impulse.z=0}else this.m_impulse.add(p)}var b=m.neo(p.x,p.y);e.subMul(n,b),i-=c*(m.cross(this.m_rA,b)+p.z),s.addMul(r,b),o+=_*(m.cross(this.m_rB,b)+p.z)}else{(u=m.zero()).addCombine(1,s,1,m.cross(o,this.m_rB)),u.subCombine(1,e,1,m.cross(i,this.m_rA));p=this.m_mass.solve22(m.neg(u));this.m_impulse.x+=p.x,this.m_impulse.y+=p.y,e.subMul(n,p),i-=c*m.cross(this.m_rA,p),s.addMul(r,p),o+=_*m.cross(this.m_rB,p)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},f.prototype.solvePositionConstraints=function(t){var e,i=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=l.neo(s),_=l.neo(n),u=0,p=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=d&&0==p){var y=n-s-this.m_referenceAngle,f=0;if(3==this.m_limitState){var v=a.clamp(y-this.m_lowerAngle,-r.maxAngularCorrection,r.maxAngularCorrection);f=-this.m_motorMass*v,u=a.abs(v)}else if(1==this.m_limitState){u=-(v=y-this.m_lowerAngle),v=a.clamp(v+r.angularSlop,-r.maxAngularCorrection,0),f=-this.m_motorMass*v}else if(2==this.m_limitState){u=v=y-this.m_upperAngle,v=a.clamp(v-r.angularSlop,0,r.maxAngularCorrection),f=-this.m_motorMass*v}s-=this.m_invIA*f,n+=this.m_invIB*f}h.set(s),_.set(n);var x=l.mulVec2(h,m.sub(this.m_localAnchorA,this.m_localCenterA)),A=l.mulVec2(_,m.sub(this.m_localAnchorB,this.m_localCenterB));(v=m.zero()).addCombine(1,o,1,A),v.subCombine(1,i,1,x),e=v.length();var g=this.m_invMassA,b=this.m_invMassB,B=this.m_invIA,w=this.m_invIB,S=new c;S.ex.x=g+b+B*x.y*x.y+w*A.y*A.y,S.ex.y=-B*x.x*x.y-w*A.x*A.y,S.ey.x=S.ex.y,S.ey.y=g+b+B*x.x*x.x+w*A.x*A.x;var C=m.neg(S.solve(v));return i.subMul(g,C),s-=B*m.cross(x,C),o.addMul(b,C),n+=w*m.cross(A,C),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.set(o),this.m_bodyB.c_position.a=n,e<=r.linearSlop&&u<=r.angularSlop}},1020:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=l;var s=i(2133),o=i(3883),n=i(9540),r=i(5890),a=(i(3588),i(6514),i(2149),i(1146)),m=(i(8804),i(8558),i(830),i(7501),i(7545)),h=i(5786),c=0;l.TYPE="rope-joint",m.TYPES[l.TYPE]=l,l._super=m,l.prototype=Object.create(l._super.prototype);var _={maxLength:0};function l(t,e,i,o){if(!(this instanceof l))return new l(t,e,i,o);t=s(t,_),m.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=l.TYPE,this.m_localAnchorA=o?e.getLocalPoint(o):t.localAnchorA||r.neo(-1,0),this.m_localAnchorB=o?i.getLocalPoint(o):t.localAnchorB||r.neo(1,0),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=c,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}l.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},l._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(h,t.bodyA,e),t.bodyB=i(h,t.bodyB,e),new l(t)},l.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},l.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},l.prototype.setMaxLength=function(t){this.m_maxLength=t},l.prototype.getMaxLength=function(){return this.m_maxLength},l.prototype.getLimitState=function(){return this.m_state},l.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},l.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},l.prototype.getReactionForce=function(t){return r.mul(this.m_impulse,this.m_u).mul(t)},l.prototype.getReactionTorque=function(t){return 0},l.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,u=a.neo(i),p=a.neo(h);this.m_rA=a.mulSub(u,this.m_localAnchorA,this.m_localCenterA),this.m_rB=a.mulSub(p,this.m_localAnchorB,this.m_localCenterB),this.m_u=r.zero(),this.m_u.addCombine(1,m,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length();var d=this.m_length-this.m_maxLength;if(this.m_state=d>0?2:c,!(this.m_length>o.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var y=r.cross(this.m_rA,this.m_u),f=r.cross(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!=v?1/v:0,t.warmStarting){this.m_impulse*=t.dtRatio;var x=r.mul(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,x),n-=this.m_invIA*r.cross(this.m_rA,x),_.addMul(this.m_invMassB,x),l+=this.m_invIB*r.cross(this.m_rB,x)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.set(_),this.m_bodyB.c_velocity.w=l},l.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=r.addCross(e,i,this.m_rA),m=r.addCross(s,o,this.m_rB),h=this.m_length-this.m_maxLength,c=r.dot(this.m_u,r.sub(m,a));h<0&&(c+=t.inv_dt*h);var _=-this.m_mass*c,l=this.m_impulse;this.m_impulse=n.min(0,this.m_impulse+_),_=this.m_impulse-l;var u=r.mul(_,this.m_u);e.subMul(this.m_invMassA,u),i-=this.m_invIA*r.cross(this.m_rA,u),s.addMul(this.m_invMassB,u),o+=this.m_invIB*r.cross(this.m_rB,u),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},l.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,h=a.neo(i),c=a.neo(m),_=a.mulSub(h,this.m_localAnchorA,this.m_localCenterA),l=a.mulSub(c,this.m_localAnchorB,this.m_localCenterB),u=r.zero();u.addCombine(1,s,1,l),u.subCombine(1,e,1,_);var p=u.normalize(),d=p-this.m_maxLength;d=n.clamp(d,0,o.maxLinearCorrection);var y=-this.m_mass*d,f=r.mul(y,u);return e.subMul(this.m_invMassA,f),i-=this.m_invIA*r.cross(_,f),s.addMul(this.m_invMassB,f),m+=this.m_invIB*r.cross(l,f),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=m,p-this.m_maxLength<o.linearSlop}},3178:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var s=i(2133),o=i(3883),n=i(9540),r=i(5890),a=i(3588),m=(i(6514),i(2149)),h=i(1146),c=(i(8804),i(8558),i(830),i(7501),i(7545)),_=i(5786);u.TYPE="weld-joint",c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var l={frequencyHz:0,dampingRatio:0};function u(t,e,i,o){if(!(this instanceof u))return new u(t,e,i,o);t=s(t,l),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_localAnchorA=r.clone(o?e.getLocalPoint(o):t.localAnchorA||r.zero()),this.m_localAnchorB=r.clone(o?i.getLocalPoint(o):t.localAnchorB||r.zero()),this.m_referenceAngle=n.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=a(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new m}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(_,t.bodyA,e),t.bodyB=i(_,t.bodyB,e),new u(t)},u.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},u.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},u.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},u.prototype.getReferenceAngle=function(){return this.m_referenceAngle},u.prototype.setFrequency=function(t){this.m_frequencyHz=t},u.prototype.getFrequency=function(){return this.m_frequencyHz},u.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},u.prototype.getDampingRatio=function(){return this.m_dampingRatio},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return r.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},u.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,_=h.neo(e),l=h.neo(o);this.m_rA=h.mulVec2(_,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=h.mulVec2(l,r.sub(this.m_localAnchorB,this.m_localCenterB));var u=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,y=this.m_invIB,f=new m;if(f.ex.x=u+p+this.m_rA.y*this.m_rA.y*d+this.m_rB.y*this.m_rB.y*y,f.ey.x=-this.m_rA.y*this.m_rA.x*d-this.m_rB.y*this.m_rB.x*y,f.ez.x=-this.m_rA.y*d-this.m_rB.y*y,f.ex.y=f.ey.x,f.ey.y=u+p+this.m_rA.x*this.m_rA.x*d+this.m_rB.x*this.m_rB.x*y,f.ez.y=this.m_rA.x*d+this.m_rB.x*y,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=d+y,this.m_frequencyHz>0){f.getInverse22(this.m_mass);var v=d+y,x=v>0?1/v:0,A=o-e-this.m_referenceAngle,g=2*n.PI*this.m_frequencyHz,b=2*x*this.m_dampingRatio*g,B=x*g*g,w=t.dt;this.m_gamma=w*(b+w*B),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=A*w*B*this.m_gamma,v+=this.m_gamma,this.m_mass.ez.z=0!=v?1/v:0}else 0==f.ez.z?(f.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(f.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var S=r.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(u,S),s-=d*(r.cross(this.m_rA,S)+this.m_impulse.z),a.addMul(p,S),c+=y*(r.cross(this.m_rB,S)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=c},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,h=this.m_invMassB,c=this.m_invIA,_=this.m_invIB;if(this.m_frequencyHz>0){var l=o-i,u=-this.m_mass.ez.z*(l+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,i-=c*u,o+=_*u,(y=r.zero()).addCombine(1,s,1,r.cross(o,this.m_rB)),y.subCombine(1,e,1,r.cross(i,this.m_rA));var p=r.neg(m.mulVec2(this.m_mass,y));this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var d=r.clone(p);e.subMul(n,d),i-=c*r.cross(this.m_rA,d),s.addMul(h,d),o+=_*r.cross(this.m_rB,d)}else{var y;(y=r.zero()).addCombine(1,s,1,r.cross(o,this.m_rB)),y.subCombine(1,e,1,r.cross(i,this.m_rA));l=o-i;var f=a(y.x,y.y,l),v=a.neg(m.mulVec3(this.m_mass,f));this.m_impulse.add(v);d=r.neo(v.x,v.y);e.subMul(n,d),i-=c*(r.cross(this.m_rA,d)+v.z),s.addMul(h,d),o+=_*(r.cross(this.m_rB,d)+v.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){var e,i,s=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,u=h.neo(c),p=h.neo(l),d=this.m_invMassA,y=this.m_invMassB,f=this.m_invIA,v=this.m_invIB,x=h.mulVec2(u,r.sub(this.m_localAnchorA,this.m_localCenterA)),A=h.mulVec2(p,r.sub(this.m_localAnchorB,this.m_localCenterB)),g=new m;if(g.ex.x=d+y+x.y*x.y*f+A.y*A.y*v,g.ey.x=-x.y*x.x*f-A.y*A.x*v,g.ez.x=-x.y*f-A.y*v,g.ex.y=g.ey.x,g.ey.y=d+y+x.x*x.x*f+A.x*A.x*v,g.ez.y=x.x*f+A.x*v,g.ex.z=g.ez.x,g.ey.z=g.ez.y,g.ez.z=f+v,this.m_frequencyHz>0){(B=r.zero()).addCombine(1,_,1,A),B.subCombine(1,s,1,x),e=B.length(),i=0;var b=r.neg(g.solve22(B));s.subMul(d,b),c-=f*r.cross(x,b),_.addMul(y,b),l+=v*r.cross(A,b)}else{var B;(B=r.zero()).addCombine(1,_,1,A),B.subCombine(1,s,1,x);var w=l-c-this.m_referenceAngle;e=B.length(),i=n.abs(w);var S=a(B.x,B.y,w),C=a();if(g.ez.z>0)C=a.neg(g.solve33(S));else{var M=r.neg(g.solve22(B));C.set(M.x,M.y,0)}b=r.neo(C.x,C.y);s.subMul(d,b),c-=f*(r.cross(x,b)+C.z),_.addMul(y,b),l+=v*(r.cross(A,b)+C.z)}return this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=c,this.m_bodyB.c_position.c=_,this.m_bodyB.c_position.a=l,e<=o.linearSlop&&i<=o.angularSlop}},6758:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var s=i(2133),o=i(3883),n=i(9540),r=i(5890),a=(i(3588),i(6514),i(2149),i(1146)),m=(i(8804),i(8558),i(830),i(7501),i(7545)),h=i(5786);_.TYPE="wheel-joint",m.TYPES[_.TYPE]=_,_._super=m,_.prototype=Object.create(_._super.prototype);var c={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function _(t,e,i,o,n){if(!(this instanceof _))return new _(t,e,i,o,n);t=s(t,c),m.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=_.TYPE,this.m_localAnchorA=r.clone(o?e.getLocalPoint(o):t.localAnchorA||r.zero()),this.m_localAnchorB=r.clone(o?i.getLocalPoint(o):t.localAnchorB||r.zero()),this.m_localXAxisA=r.clone(n?e.getLocalVector(n):t.localAxisA||t.localAxis||r.neo(1,0)),this.m_localYAxisA=r.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=r.zero(),this.m_ay=r.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}_.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},_._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(h,t.bodyA,e),t.bodyB=i(h,t.bodyB,e),new _(t)},_.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.set(t.localAxisA),this.m_localYAxisA.set(r.cross(1,t.localAxisA)))},_.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},_.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},_.prototype.getLocalAxisA=function(){return this.m_localXAxisA},_.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),s=e.getWorldPoint(this.m_localAnchorB),o=r.sub(s,i),n=t.getWorldVector(this.m_localXAxisA);return r.dot(o,n)},_.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},_.prototype.isMotorEnabled=function(){return this.m_enableMotor},_.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},_.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},_.prototype.getMotorSpeed=function(){return this.m_motorSpeed},_.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},_.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},_.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},_.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},_.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},_.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},_.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},_.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},_.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},_.prototype.getReactionForce=function(t){return r.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},_.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,m=this.m_bodyA.c_position.c,h=this.m_bodyA.c_position.a,c=this.m_bodyA.c_velocity.v,_=this.m_bodyA.c_velocity.w,l=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=a.neo(h),f=a.neo(u),v=a.mulVec2(y,r.sub(this.m_localAnchorA,this.m_localCenterA)),x=a.mulVec2(f,r.sub(this.m_localAnchorB,this.m_localCenterB));if((B=r.zero()).addCombine(1,l,1,x),B.subCombine(1,m,1,v),this.m_ay=a.mulVec2(y,this.m_localYAxisA),this.m_sAy=r.cross(r.add(B,v),this.m_ay),this.m_sBy=r.cross(x,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=a.mulVec2(y,this.m_localXAxisA),this.m_sAx=r.cross(r.add(B,v),this.m_ax),this.m_sBx=r.cross(x,this.m_ax);var A=e+i+s*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(A>0){this.m_springMass=1/A;var g=r.dot(B,this.m_ax),b=2*n.PI*this.m_frequencyHz,B=2*this.m_springMass*this.m_dampingRatio*b,w=this.m_springMass*b*b,S=t.dt;this.m_gamma=S*(B+S*w),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=g*S*w*this.m_gamma,this.m_springMass=A+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var C=r.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),M=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,I=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;c.subMul(this.m_invMassA,C),_-=this.m_invIA*M,p.addMul(this.m_invMassB,C),d+=this.m_invIB*I}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(c),this.m_bodyA.c_velocity.w=_,this.m_bodyB.c_velocity.v.set(p),this.m_bodyB.c_velocity.w=d},_.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,a=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,_=r.dot(this.m_ax,h)-r.dot(this.m_ax,a)+this.m_sBx*c-this.m_sAx*m,l=-this.m_springMass*(_+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=l;var u=r.mul(l,this.m_ax),p=l*this.m_sAx,d=l*this.m_sBx;a.subMul(e,u),m-=s*p,h.addMul(i,u);_=(c+=o*d)-m-this.m_motorSpeed,l=-this.m_motorMass*_;var y=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=n.clamp(this.m_motorImpulse+l,-f,f),m-=s*(l=this.m_motorImpulse-y),c+=o*l;_=r.dot(this.m_ay,h)-r.dot(this.m_ay,a)+this.m_sBy*c-this.m_sAy*m,l=-this.m_mass*_;this.m_impulse+=l;u=r.mul(l,this.m_ay),p=l*this.m_sAy,d=l*this.m_sBy;a.subMul(e,u),m-=s*p,h.addMul(i,u),c+=o*d,this.m_bodyA.c_velocity.v.set(a),this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v.set(h),this.m_bodyB.c_velocity.w=c},_.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,h=a.neo(i),c=a.neo(m),_=a.mulVec2(h,r.sub(this.m_localAnchorA,this.m_localCenterA)),l=a.mulVec2(c,r.sub(this.m_localAnchorB,this.m_localCenterB)),u=r.zero();u.addCombine(1,s,1,l),u.subCombine(1,e,1,_);var p,d=a.mulVec2(h,this.m_localYAxisA),y=r.cross(r.add(u,_),d),f=r.cross(l,d),v=r.dot(u,d),x=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;p=0!=x?-v/x:0;var A=r.mul(p,d),g=p*y,b=p*f;return e.subMul(this.m_invMassA,A),i-=this.m_invIA*g,s.addMul(this.m_invMassB,A),m+=this.m_invIB*b,this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=m,n.abs(v)<=o.linearSlop}},1350:(t,e,i)=>{var s=i(856),o=i(5786),n=i(7545),r=i(7176),a=i(7998),m=i(5890),h=i(3588),c=0;function _(t){var e=(t=t||{}).rootClass||s,i=t.preSerialize||function(t){return t},_=t.postSerialize||function(t,e){return t},l=t.preDeserialize||function(t){return t},u=t.postDeserialize||function(t,e){return t},p={World:s,Body:o,Joint:n,Fixture:r,Shape:a},d=Object.assign({Vec2:m,Vec3:h},p);this.toJson=function(t){var e=[],s=[t],o={};function n(t,i){if(t.__sid=t.__sid||++c,!o[t.__sid]){s.push(t);var n={refIndex:e.length+s.length,refType:i};o[t.__sid]=n}return o[t.__sid]}function r(t,e){if("object"!=typeof t||null===t)return t;if("function"==typeof t._serialize){if(t!==e)for(var s in p)if(t instanceof p[s])return n(t,s);t=function(t){var e=(t=i(t))._serialize();return _(e,t)}(t)}if(Array.isArray(t)){for(var o=[],a=0;a<t.length;a++)o[a]=r(t[a]);t=o}else{o={};for(var a in t)t.hasOwnProperty(a)&&(o[a]=r(t[a]));t=o}return t}for(;s.length;){var a=s.shift(),m=r(a,a);e.push(m)}return e},this.fromJson=function(t){var i={};function s(t,e,i){e=l(e);var s=t._deserialize(e,i,o);return s=u(s,e)}function o(e,o,n){if(!o.refIndex)return e&&e._deserialize&&s(e,o,n);e=d[o.refType]||e;var r=o.refIndex;if(!i[r]){var a=s(e,t[r],n);i[r]=a}return i[r]}return e._deserialize(t[0],null,o)}}t.exports=_;var l=new _;t.exports.toJson=l.toJson,t.exports.fromJson=l.fromJson},8055:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=o;i(1689);var s=i(9420);function o(t,e,i,s){if(!(this instanceof o))return new o(t,e,i,s);o._super.call(this),this._setAsBox(t,e,i,s)}o._super=s,o.prototype=Object.create(o._super.prototype),o.TYPE="polygon"},6132:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=c;var o=i(1689),n=(i(2133),i(9540),i(8558)),r=(i(1146),i(5890)),a=(i(1202),i(3883)),m=i(7998),h=i(2843);function c(t,e){if(!(this instanceof c))return new c(t,e);c._super.call(this),this.m_type=c.TYPE,this.m_radius=a.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_isLoop=e,t&&t.length&&(e?this._createLoop(t):this._createChain(t))}c._super=m,c.prototype=Object.create(c._super.prototype),c.TYPE="chain",m.TYPES[c.TYPE]=c,c.prototype._serialize=function(){const t={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},c._deserialize=function(t,e,i){var s=[];if(t.vertices)for(var o=0;o<t.vertices.length;o++)s.push(i(r,t.vertices[o]));var n=new c(s,t.isLoop);return t.prevVertex&&n.setPrevVertex(t.prevVertex),t.nextVertex&&n.setNextVertex(t.nextVertex),n},c.prototype._createLoop=function(t){s&&o.assert(0==this.m_vertices.length&&0==this.m_count),s&&o.assert(t.length>=3);for(var e=1;e<t.length;++e){var i=t[e-1],n=t[e];s&&o.assert(r.distanceSquared(i,n)>a.linearSlopSquared)}this.m_vertices=[],this.m_count=t.length+1;for(e=0;e<t.length;++e)this.m_vertices[e]=r.clone(t[e]);return this.m_vertices[t.length]=r.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},c.prototype._createChain=function(t){s&&o.assert(0==this.m_vertices.length&&0==this.m_count),s&&o.assert(t.length>=2);for(var e=1;e<t.length;++e){var i=t[e-1],n=t[e];s&&o.assert(r.distanceSquared(i,n)>a.linearSlopSquared)}this.m_count=t.length;for(e=0;e<t.length;++e)this.m_vertices[e]=r.clone(t[e]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},c.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},c.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},c.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},c.prototype._clone=function(){var t=new c;return t.createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},c.prototype.getChildCount=function(){return this.m_count-1},c.prototype.getChildEdge=function(t,e){s&&o.assert(0<=e&&e<this.m_count-1),t.m_type=h.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},c.prototype.getVertex=function(t){return s&&o.assert(0<=t&&t<=this.m_count),t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},c.prototype.testPoint=function(t,e){return!1},c.prototype.rayCast=function(t,e,i,n){return s&&o.assert(0<=n&&n<this.m_count),new h(this.getVertex(n),this.getVertex(n+1)).rayCast(t,e,i,0)},c.prototype.computeAABB=function(t,e,i){s&&o.assert(0<=i&&i<this.m_count);var r=n.mulVec2(e,this.getVertex(i)),a=n.mulVec2(e,this.getVertex(i+1));t.combinePoints(r,a)},c.prototype.computeMass=function(t,e){t.mass=0,t.center=r.neo(),t.I=0},c.prototype.computeDistanceProxy=function(t,e){s&&o.assert(0<=e&&e<this.m_count),t.m_buffer[0]=this.getVertex(e),t.m_buffer[1]=this.getVertex(e+1),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius}},9568:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var o=i(1689),n=(i(2133),i(9540)),r=(i(8558),i(1146)),a=i(5890),m=(i(1202),i(3883),i(7998));function h(t,e){if(!(this instanceof h))return new h(t,e);h._super.call(this),this.m_type=h.TYPE,this.m_p=a.zero(),this.m_radius=1,"object"==typeof t&&a.isValid(t)?(this.m_p.set(t),"number"==typeof e&&(this.m_radius=e)):"number"==typeof t&&(this.m_radius=t)}h._super=m,h.prototype=Object.create(h._super.prototype),h.TYPE="circle",m.TYPES[h.TYPE]=h,h.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},h._deserialize=function(t){return new h(t.p,t.radius)},h.prototype.getRadius=function(){return this.m_radius},h.prototype.getCenter=function(){return this.m_p},h.prototype.getVertex=function(t){return s&&o.assert(0==t),this.m_p},h.prototype.getVertexCount=function(t){return 1},h.prototype._clone=function(){var t=new h;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},h.prototype.getChildCount=function(){return 1},h.prototype.testPoint=function(t,e){var i=a.add(t.p,r.mulVec2(t.q,this.m_p)),s=a.sub(e,i);return a.dot(s,s)<=this.m_radius*this.m_radius},h.prototype.rayCast=function(t,e,i,s){var o=a.add(i.p,r.mulVec2(i.q,this.m_p)),m=a.sub(e.p1,o),h=a.dot(m,m)-this.m_radius*this.m_radius,c=a.sub(e.p2,e.p1),_=a.dot(m,c),l=a.dot(c,c),u=_*_-l*h;if(u<0||l<n.EPSILON)return!1;var p=-(_+n.sqrt(u));return 0<=p&&p<=e.maxFraction*l&&(p/=l,t.fraction=p,t.normal=a.add(m,a.mul(p,c)),t.normal.normalize(),!0)},h.prototype.computeAABB=function(t,e,i){var s=a.add(e.p,r.mulVec2(e.q,this.m_p));t.lowerBound.set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.set(s.x+this.m_radius,s.y+this.m_radius)},h.prototype.computeMass=function(t,e){t.mass=e*n.PI*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+a.dot(this.m_p,this.m_p))},h.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},6156:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(1689),n=(i(9540),i(8558)),r=i(5890),a=(i(3883),i(7998),i(5676)),m=i(5713),h=i(9568);function c(t,e,i,s,o){t.pointCount=0;var a=n.mulVec2(i,e.m_p),h=n.mulVec2(o,s.m_p),c=r.distanceSquared(h,a),_=e.m_radius+s.m_radius;c>_*_||(t.type=m.e_circles,t.localPoint.set(e.m_p),t.localNormal.setZero(),t.pointCount=1,t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=m.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=m.e_vertex)}a.addType(h.TYPE,h.TYPE,(function(t,e,i,n,r,a,m){s&&o.assert(i.getType()==h.TYPE),s&&o.assert(a.getType()==h.TYPE),c(t,i.getShape(),e,a.getShape(),r)})),e.CollideCircles=c},2976:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(1689),n=i(9540),r=i(8558),a=(i(1146),i(5890)),m=(i(1202),i(3883),i(5713)),h=i(5676),c=(i(7998),i(9568)),_=i(9420);h.addType(_.TYPE,c.TYPE,(function(t,e,i,h,l,u,p){s&&o.assert(i.getType()==_.TYPE),s&&o.assert(u.getType()==c.TYPE),function(t,e,i,s,o){t.pointCount=0;for(var h=r.mulVec2(o,s.m_p),c=r.mulTVec2(i,h),_=0,l=-1/0,u=e.m_radius+s.m_radius,p=e.m_count,d=e.m_vertices,y=e.m_normals,f=0;f<p;++f){var v=a.dot(y[f],a.sub(c,d[f]));if(v>u)return;v>l&&(l=v,_=f)}var x=_,A=x+1<p?x+1:0,g=d[x],b=d[A];if(l<n.EPSILON)return t.pointCount=1,t.type=m.e_faceA,t.localNormal.set(y[_]),t.localPoint.setCombine(.5,g,.5,b),t.points[0].localPoint=s.m_p,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=m.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=m.e_vertex);var B=a.dot(a.sub(c,g),a.sub(b,g)),w=a.dot(a.sub(c,b),a.sub(g,b));if(B<=0){if(a.distanceSquared(c,g)>u*u)return;t.pointCount=1,t.type=m.e_faceA,t.localNormal.setCombine(1,c,-1,g),t.localNormal.normalize(),t.localPoint=g,t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=m.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=m.e_vertex}else if(w<=0){if(a.distanceSquared(c,b)>u*u)return;t.pointCount=1,t.type=m.e_faceA,t.localNormal.setCombine(1,c,-1,b),t.localNormal.normalize(),t.localPoint.set(b),t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=m.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=m.e_vertex}else{var S=a.mid(g,b);if((l=a.dot(c,y[x])-a.dot(S,y[x]))>u)return;t.pointCount=1,t.type=m.e_faceA,t.localNormal.set(y[x]),t.localPoint.set(S),t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=m.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=m.e_vertex}}(t,i.getShape(),e,u.getShape(),l)}))},7618:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(1689),n=(i(9540),i(8558)),r=i(5890),a=(i(1146),i(3883),i(7998),i(5676)),m=i(5713),h=i(2843),c=i(6132),_=i(9568);function l(t,e,i,a,h){t.pointCount=0;var c=n.mulTVec2(i,n.mulVec2(h,a.m_p)),_=e.m_vertex1,l=e.m_vertex2,u=r.sub(l,_),p=r.dot(u,r.sub(l,c)),d=r.dot(u,r.sub(c,_)),y=e.m_radius+a.m_radius;if(d<=0){var f=r.clone(_),v=r.sub(c,f);if(r.dot(v,v)>y*y)return;if(e.m_hasVertex0){var x=e.m_vertex0,A=_,g=r.sub(A,x);if(r.dot(g,r.sub(A,c))>0)return}return t.type=m.e_circles,t.localNormal.setZero(),t.localPoint.set(f),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=m.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=m.e_vertex)}if(p<=0){f=r.clone(l),v=r.sub(c,f);if(r.dot(v,v)>y*y)return;if(e.m_hasVertex3){var b=e.m_vertex3,B=l,w=r.sub(b,B);if(r.dot(w,r.sub(c,B))>0)return}return t.type=m.e_circles,t.localNormal.setZero(),t.localPoint.set(f),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=1,t.points[0].id.cf.typeA=m.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=m.e_vertex)}var S=r.dot(u,u);s&&o.assert(S>0);f=r.combine(p/S,_,d/S,l),v=r.sub(c,f);if(!(r.dot(v,v)>y*y)){var C=r.neo(-u.y,u.x);r.dot(C,r.sub(c,_))<0&&C.set(-C.x,-C.y),C.normalize(),t.type=m.e_faceA,t.localNormal=C,t.localPoint.set(_),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=m.e_face,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=m.e_vertex}}a.addType(h.TYPE,_.TYPE,(function(t,e,i,n,r,a,m){s&&o.assert(i.getType()==h.TYPE),s&&o.assert(a.getType()==_.TYPE);var c=i.getShape(),u=a.getShape();l(t,c,e,u,r)})),a.addType(c.TYPE,_.TYPE,(function(t,e,i,n,r,a,m){s&&o.assert(i.getType()==c.TYPE),s&&o.assert(a.getType()==_.TYPE);var u=i.getShape(),p=new h;u.getChildEdge(p,n);var d=p,y=a.getShape();l(t,d,e,y,r)}))},5438:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(1689),n=i(9540),r=i(8558),a=i(5890),m=i(1146),h=i(3883),c=(i(7998),i(5676)),_=i(5713),l=i(2843),u=i(6132),p=i(9420);c.addType(l.TYPE,p.TYPE,(function(t,e,i,n,r,a,m){s&&o.assert(i.getType()==l.TYPE),s&&o.assert(a.getType()==p.TYPE),B(t,i.getShape(),e,a.getShape(),r)})),c.addType(u.TYPE,p.TYPE,(function(t,e,i,n,r,a,m){s&&o.assert(i.getType()==u.TYPE),s&&o.assert(a.getType()==p.TYPE);var h=i.getShape(),c=new l;h.getChildEdge(c,n),B(t,c,e,a.getShape(),r)}));var d=-1,y=1,f=2;function v(){this.type,this.index,this.separation}var x=new v,A=new v,g=new function(){this.vertices=[],this.normals=[],this.count=0},b=new function(){this.i1,this.i2,this.v1,this.v2,this.normal=a.zero(),this.sideNormal1=a.zero(),this.sideOffset1,this.sideNormal2=a.zero(),this.sideOffset2};function B(t,e,i,s,o){var c=r.mulTXf(i,o),l=r.mulVec2(c,s.m_centroid),u=e.m_vertex0,p=e.m_vertex1,v=e.m_vertex2,B=e.m_vertex3,w=e.m_hasVertex0,S=e.m_hasVertex3,C=a.sub(v,p);C.normalize();var M,I=a.neo(C.y,-C.x),T=a.dot(I,a.sub(l,p)),P=0,V=0,z=!1,E=!1;if(w){var L=a.sub(p,u);L.normalize();var q=a.neo(L.y,-L.x);z=a.cross(L,C)>=0,P=a.dot(q,l)-a.dot(q,u)}if(S){var F=a.sub(B,v);F.normalize();var D=a.neo(F.y,-F.x);E=a.cross(C,F)>0,V=a.dot(D,l)-a.dot(D,v)}var R=a.zero(),k=a.zero(),j=a.zero();w&&S?z&&E?(M=P>=0||T>=0||V>=0)?(R.set(I),k.set(q),j.set(D)):(R.setMul(-1,I),k.setMul(-1,I),j.setMul(-1,I)):z?(M=P>=0||T>=0&&V>=0)?(R.set(I),k.set(q),j.set(I)):(R.setMul(-1,I),k.setMul(-1,D),j.setMul(-1,I)):E?(M=V>=0||P>=0&&T>=0)?(R.set(I),k.set(I),j.set(D)):(R.setMul(-1,I),k.setMul(-1,I),j.setMul(-1,q)):(M=P>=0&&T>=0&&V>=0)?(R.set(I),k.set(I),j.set(I)):(R.setMul(-1,I),k.setMul(-1,D),j.setMul(-1,q)):w?z?(M=P>=0||T>=0)?(R.set(I),k.set(q),j.setMul(-1,I)):(R.setMul(-1,I),k.set(I),j.setMul(-1,I)):(M=P>=0&&T>=0)?(R.set(I),k.set(I),j.setMul(-1,I)):(R.setMul(-1,I),k.set(I),j.setMul(-1,q)):S?E?(M=T>=0||V>=0)?(R.set(I),k.setMul(-1,I),j.set(D)):(R.setMul(-1,I),k.setMul(-1,I),j.set(I)):(M=T>=0&&V>=0)?(R.set(I),k.setMul(-1,I),j.set(I)):(R.setMul(-1,I),k.setMul(-1,D),j.set(I)):(M=T>=0)?(R.set(I),k.setMul(-1,I),j.setMul(-1,I)):(R.setMul(-1,I),k.set(I),j.set(I)),g.count=s.m_count;for(var O=0;O<s.m_count;++O)g.vertices[O]=r.mulVec2(c,s.m_vertices[O]),g.normals[O]=m.mulVec2(c.q,s.m_normals[O]);var G=2*h.polygonRadius;t.pointCount=0,x.type=y,x.index=M?0:1,x.separation=1/0;for(O=0;O<g.count;++O){(Y=a.dot(R,a.sub(g.vertices[O],p)))<x.separation&&(x.separation=Y)}if(x.type!=d&&!(x.separation>G)){A.type=d,A.index=-1,A.separation=-1/0;var U=a.neo(-R.y,R.x);for(O=0;O<g.count;++O){var Y,N=a.neg(g.normals[O]),W=a.dot(N,a.sub(g.vertices[O],p)),J=a.dot(N,a.sub(g.vertices[O],v));if((Y=n.min(W,J))>G){A.type=f,A.index=O,A.separation=Y;break}if(a.dot(N,U)>=0){if(a.dot(a.sub(N,j),R)<-h.angularSlop)continue}else if(a.dot(a.sub(N,k),R)<-h.angularSlop)continue;Y>A.separation&&(A.type=f,A.index=O,A.separation=Y)}if(!(A.type!=d&&A.separation>G)){var H;H=A.type==d?x:A.separation>.98*x.separation+.001?A:x;var Z=[new _.clipVertex,new _.clipVertex];if(H.type==y){t.type=_.e_faceA;var X=0,K=a.dot(R,g.normals[0]);for(O=1;O<g.count;++O){var Q=a.dot(R,g.normals[O]);Q<K&&(K=Q,X=O)}var $=X,tt=$+1<g.count?$+1:0;Z[0].v=g.vertices[$],Z[0].id.cf.indexA=0,Z[0].id.cf.indexB=$,Z[0].id.cf.typeA=_.e_face,Z[0].id.cf.typeB=_.e_vertex,Z[1].v=g.vertices[tt],Z[1].id.cf.indexA=0,Z[1].id.cf.indexB=tt,Z[1].id.cf.typeA=_.e_face,Z[1].id.cf.typeB=_.e_vertex,M?(b.i1=0,b.i2=1,b.v1=p,b.v2=v,b.normal.set(I)):(b.i1=1,b.i2=0,b.v1=v,b.v2=p,b.normal.setMul(-1,I))}else t.type=_.e_faceB,Z[0].v=p,Z[0].id.cf.indexA=0,Z[0].id.cf.indexB=H.index,Z[0].id.cf.typeA=_.e_vertex,Z[0].id.cf.typeB=_.e_face,Z[1].v=v,Z[1].id.cf.indexA=0,Z[1].id.cf.indexB=H.index,Z[1].id.cf.typeA=_.e_vertex,Z[1].id.cf.typeB=_.e_face,b.i1=H.index,b.i2=b.i1+1<g.count?b.i1+1:0,b.v1=g.vertices[b.i1],b.v2=g.vertices[b.i2],b.normal.set(g.normals[b.i1]);b.sideNormal1.set(b.normal.y,-b.normal.x),b.sideNormal2.setMul(-1,b.sideNormal1),b.sideOffset1=a.dot(b.sideNormal1,b.v1),b.sideOffset2=a.dot(b.sideNormal2,b.v2);var et=[new _.clipVertex,new _.clipVertex],it=[new _.clipVertex,new _.clipVertex];if(!(_.clipSegmentToLine(et,Z,b.sideNormal1,b.sideOffset1,b.i1)<h.maxManifoldPoints||_.clipSegmentToLine(it,et,b.sideNormal2,b.sideOffset2,b.i2)<h.maxManifoldPoints)){H.type==y?(t.localNormal=a.clone(b.normal),t.localPoint=a.clone(b.v1)):(t.localNormal=a.clone(s.m_normals[b.i1]),t.localPoint=a.clone(s.m_vertices[b.i1]));var st=0;for(O=0;O<h.maxManifoldPoints;++O){if(a.dot(b.normal,a.sub(it[O].v,b.v1))<=G){var ot=t.points[st];H.type==y?(ot.localPoint=r.mulT(c,it[O].v),ot.id=it[O].id):(ot.localPoint=it[O].v,ot.id.cf.typeA=it[O].id.cf.typeB,ot.id.cf.typeB=it[O].id.cf.typeA,ot.id.cf.indexA=it[O].id.cf.indexB,ot.id.cf.indexB=it[O].id.cf.indexA),++st}}t.pointCount=st}}}}},5199:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(1689),n=(i(9540),i(8558)),r=i(1146),a=i(5890),m=(i(1202),i(3883)),h=i(5713),c=i(5676),_=(i(7998),i(9420));function l(t,e,i,s){for(var o=t.m_count,m=i.m_count,h=t.m_normals,c=t.m_vertices,_=i.m_vertices,u=n.mulTXf(s,e),p=0,d=-1/0,y=0;y<o;++y){for(var f=r.mulVec2(u.q,h[y]),v=n.mulVec2(u,c[y]),x=1/0,A=0;A<m;++A){var g=a.dot(f,_[A])-a.dot(f,v);g<x&&(x=g)}x>d&&(d=x,p=y)}l._maxSeparation=d,l._bestIndex=p}function u(t,e,i,c,_){t.pointCount=0;var u=e.m_radius+c.m_radius;l(e,i,c,_);var p=l._bestIndex,d=l._maxSeparation;if(!(d>u)){l(c,_,e,i);var y=l._bestIndex,f=l._maxSeparation;if(!(f>u)){var v,x,A,g,b,B;f>d+.1*m.linearSlop?(v=c,x=e,A=_,g=i,b=y,t.type=h.e_faceB,B=1):(v=e,x=c,A=i,g=_,b=p,t.type=h.e_faceA,B=0);var w=[new h.clipVertex,new h.clipVertex];!function(t,e,i,m,c,_){var l=e.m_normals,u=c.m_count,p=c.m_vertices,d=c.m_normals;s&&o.assert(0<=m&&m<e.m_count);for(var y=r.mulT(_.q,r.mulVec2(i.q,l[m])),f=0,v=1/0,x=0;x<u;++x){var A=a.dot(y,d[x]);A<v&&(v=A,f=x)}var g=f,b=g+1<u?g+1:0;t[0].v=n.mulVec2(_,p[g]),t[0].id.cf.indexA=m,t[0].id.cf.indexB=g,t[0].id.cf.typeA=h.e_face,t[0].id.cf.typeB=h.e_vertex,t[1].v=n.mulVec2(_,p[b]),t[1].id.cf.indexA=m,t[1].id.cf.indexB=b,t[1].id.cf.typeA=h.e_face,t[1].id.cf.typeB=h.e_vertex}(w,v,A,b,x,g);var S=v.m_count,C=v.m_vertices,M=b,I=b+1<S?b+1:0,T=C[M],P=C[I],V=a.sub(P,T);V.normalize();var z=a.cross(V,1),E=a.combine(.5,T,.5,P),L=r.mulVec2(A.q,V),q=a.cross(L,1);T=n.mulVec2(A,T),P=n.mulVec2(A,P);var F=a.dot(q,T),D=-a.dot(L,T)+u,R=a.dot(L,P)+u,k=[new h.clipVertex,new h.clipVertex],j=[new h.clipVertex,new h.clipVertex];if(!(h.clipSegmentToLine(k,w,a.neg(L),D,M)<2||h.clipSegmentToLine(j,k,L,R,I)<2)){t.localNormal=z,t.localPoint=E;for(var O=0,G=0;G<j.length;++G){if(a.dot(q,j[G].v)-F<=u){var U=t.points[O];if(U.localPoint.set(n.mulTVec2(g,j[G].v)),U.id=j[G].id,B){var Y=U.id.cf,N=Y.indexA,W=Y.indexB,J=Y.typeA,H=Y.typeB;Y.indexA=W,Y.indexB=N,Y.typeA=H,Y.typeB=J}++O}}t.pointCount=O}}}}t.exports=u,c.addType(_.TYPE,_.TYPE,(function(t,e,i,n,r,a,m){s&&o.assert(i.getType()==_.TYPE),s&&o.assert(a.getType()==_.TYPE),u(t,i.getShape(),e,a.getShape(),r)}))},2843:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=m;i(2133);var s=i(3883),o=i(7998),n=(i(9540),i(8558)),r=i(1146),a=i(5890);i(1202);function m(t,e){if(!(this instanceof m))return new m(t,e);m._super.call(this),this.m_type=m.TYPE,this.m_radius=s.polygonRadius,this.m_vertex1=t?a.clone(t):a.zero(),this.m_vertex2=e?a.clone(e):a.zero(),this.m_vertex0=a.zero(),this.m_vertex3=a.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}m._super=o,m.prototype=Object.create(m._super.prototype),m.TYPE="edge",o.TYPES[m.TYPE]=m,m.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},m._deserialize=function(t){var e=new m(t.vertex1,t.vertex2);return e.hasVertex0&&e.setPrev(t.vertex0),e.hasVertex3&&e.setNext(t.vertex3),e},m.prototype.setNext=function(t){return t?(this.m_vertex3.set(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},m.prototype.setPrev=function(t){return t?(this.m_vertex0.set(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},m.prototype._set=function(t,e){return this.m_vertex1.set(t),this.m_vertex2.set(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},m.prototype._clone=function(){var t=new m;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.set(this.m_vertex1),t.m_vertex2.set(this.m_vertex2),t.m_vertex0.set(this.m_vertex0),t.m_vertex3.set(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},m.prototype.getChildCount=function(){return 1},m.prototype.testPoint=function(t,e){return!1},m.prototype.rayCast=function(t,e,i,s){var o=r.mulTVec2(i.q,a.sub(e.p1,i.p)),n=r.mulTVec2(i.q,a.sub(e.p2,i.p)),m=a.sub(n,o),h=this.m_vertex1,c=this.m_vertex2,_=a.sub(c,h),l=a.neo(_.y,-_.x);l.normalize();var u=a.dot(l,a.sub(h,o)),p=a.dot(l,m);if(0==p)return!1;var d=u/p;if(d<0||e.maxFraction<d)return!1;var y=a.add(o,a.mul(d,m)),f=a.sub(c,h),v=a.dot(f,f);if(0==v)return!1;var x=a.dot(a.sub(y,h),f)/v;return!(x<0||1<x)&&(t.fraction=d,t.normal=u>0?r.mulVec2(i.q,l).neg():r.mulVec2(i.q,l),!0)},m.prototype.computeAABB=function(t,e,i){var s=n.mulVec2(e,this.m_vertex1),o=n.mulVec2(e,this.m_vertex2);t.combinePoints(s,o),t.extend(this.m_radius)},m.prototype.computeMass=function(t,e){t.mass=0,t.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},m.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_vertex1),t.m_vertices.push(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},9420:(t,e,i)=>{"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var o=i(1689),n=(i(2133),i(9540)),r=i(8558),a=i(1146),m=i(5890),h=(i(1202),i(3883)),c=i(7998);function _(t){if(!(this instanceof _))return new _(t);_._super.call(this),this.m_type=_.TYPE,this.m_radius=h.polygonRadius,this.m_centroid=m.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,t&&t.length&&this._set(t)}_._super=c,_.prototype=Object.create(_._super.prototype),_.TYPE="polygon",c.TYPES[_.TYPE]=_,_.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},_._deserialize=function(t,e,i){var s=[];if(t.vertices)for(var o=0;o<t.vertices.length;o++)s.push(i(m,t.vertices[o]));return new _(s)},_.prototype.getVertex=function(t){return s&&o.assert(0<=t&&t<this.m_count),this.m_vertices[t]},_.prototype._clone=function(){var t=new _;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.set(this.m_centroid);for(var e=0;e<this.m_count;e++)t.m_vertices.push(this.m_vertices[e].clone());for(e=0;e<this.m_normals.length;e++)t.m_normals.push(this.m_normals[e].clone());return t},_.prototype.getChildCount=function(){return 1},_.prototype._reset=function(){this._set(this.m_vertices)},_.prototype._set=function(t){if(s&&o.assert(3<=t.length&&t.length<=h.maxPolygonVertices),t.length<3)this._setAsBox(1,1);else{for(var e=n.min(t.length,h.maxPolygonVertices),i=[],r=0;r<e;++r){for(var a=t[r],c=!0,_=0;_<i.length;++_)if(m.distanceSquared(a,i[_])<.25*h.linearSlopSquared){c=!1;break}c&&i.push(a)}if((e=i.length)<3)return s&&o.assert(!1),void this._setAsBox(1,1);var l=0,u=i[0].x;for(r=1;r<e;++r){var p=i[r].x;(p>u||p===u&&i[r].y<i[l].y)&&(l=r,u=p)}for(var d=[],y=0,f=l;;){d[y]=f;var v=0;for(_=1;_<e;++_)if(v!==f){var x=m.sub(i[v],i[d[y]]),A=(a=m.sub(i[_],i[d[y]]),m.cross(x,a));A<0&&(v=_),0===A&&a.lengthSquared()>x.lengthSquared()&&(v=_)}else v=_;if(++y,f=v,v===l)break}if(y<3)return s&&o.assert(!1),void this._setAsBox(1,1);this.m_count=y,this.m_vertices=[];for(r=0;r<y;++r)this.m_vertices[r]=i[d[r]];for(r=0;r<y;++r){var g=r,b=r+1<y?r+1:0,B=m.sub(this.m_vertices[b],this.m_vertices[g]);s&&o.assert(B.lengthSquared()>n.EPSILON*n.EPSILON),this.m_normals[r]=m.cross(B,1),this.m_normals[r].normalize()}this.m_centroid=function(t,e){s&&o.assert(e>=3);for(var i=m.zero(),r=0,a=m.zero(),h=1/3,c=0;c<e;++c){var _=a,l=t[c],u=c+1<e?t[c+1]:t[0],p=m.sub(l,_),d=m.sub(u,_),y=.5*m.cross(p,d);r+=y,i.addMul(y*h,_),i.addMul(y*h,l),i.addMul(y*h,u)}return s&&o.assert(r>n.EPSILON),i.mul(1/r),i}(this.m_vertices,y)}},_.prototype._setAsBox=function(t,e,i,s){if(this.m_vertices[0]=m.neo(t,-e),this.m_vertices[1]=m.neo(t,e),this.m_vertices[2]=m.neo(-t,e),this.m_vertices[3]=m.neo(-t,-e),this.m_normals[0]=m.neo(1,0),this.m_normals[1]=m.neo(0,1),this.m_normals[2]=m.neo(-1,0),this.m_normals[3]=m.neo(0,-1),this.m_count=4,m.isValid(i)){s=s||0,this.m_centroid.set(i);var o=r.identity();o.p.set(i),o.q.set(s);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=r.mulVec2(o,this.m_vertices[n]),this.m_normals[n]=a.mulVec2(o.q,this.m_normals[n])}},_.prototype.testPoint=function(t,e){for(var i=a.mulTVec2(t.q,m.sub(e,t.p)),s=0;s<this.m_count;++s){if(m.dot(this.m_normals[s],m.sub(i,this.m_vertices[s]))>0)return!1}return!0},_.prototype.rayCast=function(t,e,i,n){for(var r=a.mulTVec2(i.q,m.sub(e.p1,i.p)),h=a.mulTVec2(i.q,m.sub(e.p2,i.p)),c=m.sub(h,r),_=0,l=e.maxFraction,u=-1,p=0;p<this.m_count;++p){var d=m.dot(this.m_normals[p],m.sub(this.m_vertices[p],r)),y=m.dot(this.m_normals[p],c);if(0==y){if(d<0)return!1}else y<0&&d<_*y?(_=d/y,u=p):y>0&&d<l*y&&(l=d/y);if(l<_)return!1}return s&&o.assert(0<=_&&_<=e.maxFraction),u>=0&&(t.fraction=_,t.normal=a.mulVec2(i.q,this.m_normals[u]),!0)},_.prototype.computeAABB=function(t,e,i){for(var s=1/0,o=1/0,a=-1/0,m=-1/0,h=0;h<this.m_count;++h){var c=r.mulVec2(e,this.m_vertices[h]);s=n.min(s,c.x),a=n.max(a,c.x),o=n.min(o,c.y),m=n.max(m,c.y)}t.lowerBound.set(s,o),t.upperBound.set(a,m),t.extend(this.m_radius)},_.prototype.computeMass=function(t,e){s&&o.assert(this.m_count>=3);for(var i=m.zero(),r=0,a=0,h=m.zero(),c=0;c<this.m_count;++c)h.add(this.m_vertices[c]);h.mul(1/this.m_count);var _=1/3;for(c=0;c<this.m_count;++c){var l=m.sub(this.m_vertices[c],h),u=c+1<this.m_count?m.sub(this.m_vertices[c+1],h):m.sub(this.m_vertices[0],h),p=m.cross(l,u),d=.5*p;r+=d,i.addCombine(d*_,l,d*_,u);var y=l.x,f=l.y,v=u.x,x=u.y;a+=.25*_*p*(y*y+v*y+v*v+(f*f+x*f+x*x))}t.mass=e*r,s&&o.assert(r>n.EPSILON),i.mul(1/r),t.center.setCombine(1,i,1,h),t.I=e*a,t.I+=t.mass*(m.dot(t.center,t.center)-m.dot(i,i))},_.prototype.validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=t<this.m_count-1?e+1:0,s=this.m_vertices[e],o=m.sub(this.m_vertices[i],s),n=0;n<this.m_count;++n)if(n!=e&&n!=i){var r=m.sub(this.m_vertices[n],s);if(m.cross(o,r)<0)return!1}return!0},_.prototype.computeDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},8621:t=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=function(t){var e=[],i=t.max||1/0,s=t.create,o=t.allocate,n=t.release,r=t.discard,a=0,m=0,h=0,c=0;this.max=function(t){return"number"==typeof t?(i=t,this):i},this.size=function(){return e.length},this.allocate=function(){var t;return e.length>0?t=e.shift():(a++,t="function"==typeof s?s():{}),m++,"function"==typeof o&&o(t),t},this.release=function(t){e.length<i?(h++,"function"==typeof n&&n(t),e.push(t)):(c++,"function"==typeof r&&(t=r(t)))},this.toString=function(){return" +"+a+" >"+m+" <"+h+" -"+c+" ="+e.length+"/"+i}}},2084:t=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports.now=function(){return Date.now()},t.exports.diff=function(t){return Date.now()-t}},1689:(t,e)=>{var i="undefined"!=typeof DEBUG&&DEBUG,s="undefined"!=typeof ASSERT&&ASSERT;e.debug=function(){i&&console.log.apply(console,arguments)},e.assert=function(t,e,i){if(s&&!t)throw i&&console.log(i),new Error(e)}},2133:t=>{"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,Object.prototype.propertyIsEnumerable;t.exports=function(t,e){null==t&&(t={});var i=Object.assign({},t);for(var s in e)e.hasOwnProperty(s)&&void 0===t[s]&&(i[s]=e[s]);if("function"==typeof Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),n=0;n<o.length;n++){var r=o[n];e.propertyIsEnumerable(r)&&void 0===t[s]&&(i[r]=e[r])}return i}},9685:t=>{function e(t){this.array=[],this.maxLength=t}e.prototype.get=function(t){return t>=this.array.length?null:this.array[t]},e.prototype.last=function(){return 0==this.array.length?null:this.array[this.array.length-1]},e.prototype.add=function(t){this.array.push(t),this.array.length>=this.maxLength&&this.array.splice(0,1)},e.prototype.length=function(){return this.array.length},e.prototype.clear=function(){this.array=[]},e.prototype.copy=function(){var t=new e(this.maxLength);return t.array=this.array.slice(0),t},e.prototype.remove=function(t,e){this.array.splice(t,e)},t.exports=e},687:t=>{function e(t){t=t||{},this.freqMin=t.freqMin||18500,this.freqMax=t.freqMax||19500,this.freqError=t.freqError||50,this.alphabetString=t.alphabet||"\n abcdefghijklmnopqrstuvwxyz0123456789,.!?@*",this.startChar=t.startChar||"^",this.endChar=t.endChar||"$",this.alphabet=this.startChar+this.alphabetString+this.endChar}e.prototype.charToFreq=function(t){var e=this.alphabet.indexOf(t);-1==e&&(console.error(t,"is an invalid character."),e=this.alphabet.length-1);var i=this.freqMax-this.freqMin,s=e/this.alphabet.length,o=Math.round(i*s);return this.freqMin+o},e.prototype.freqToChar=function(t){if(!(this.freqMin<t&&t<this.freqMax))if(this.freqMin-t<this.freqError)t=this.freqMin;else{if(!(t-this.freqMax<this.freqError))return console.error(t,"is out of range."),null;t=this.freqMax}var e=this.freqMax-this.freqMin,i=(t-this.freqMin)/e,s=Math.round(this.alphabet.length*i);return this.alphabet[s]},t.exports=e},9044:(t,e,i)=>{var s=i(9685),o=i(687),n=new window.AudioContext||new webkitAudioContext;function r(t){t=t||{},this.peakThreshold=t.peakThreshold||-65,this.minRunLength=t.minRunLength||2,this.coder=t.coder||new o(t),this.timeout=t.timeout||300,this.debug=!!t.debug,this.peakHistory=new s(16),this.peakTimes=new s(16),this.callbacks={},this.buffer="",this.state=a.IDLE,this.isRunning=!1,this.iteration=0}var a={IDLE:1,RECV:2};r.prototype.start=function(){navigator.webkitGetUserMedia({audio:{optional:[{echoCancellation:!1}]}},this.onStream_.bind(this),this.onStreamError_.bind(this))},r.prototype.stop=function(){this.isRunning=!1,this.track.stop()},r.prototype.on=function(t,e){"message"==t&&(this.callbacks.message=e),"character"==t&&(this.callbacks.character=e)},r.prototype.setDebug=function(t){this.debug=t;var e=document.querySelector("canvas");e&&e.parentElement.removeChild(e)},r.prototype.fire_=function(t,e){"function"==typeof t&&t(e)},r.prototype.onStream_=function(t){this.track=t.getTracks()[0];var e=n.createMediaStreamSource(t),i=n.createAnalyser();e.connect(i),this.freqs=new Float32Array(i.frequencyBinCount),this.analyser=i,this.isRunning=!0,this.raf_(this.loop.bind(this))},r.prototype.onStreamError_=function(t){console.error("Audio input error:",t)},r.prototype.getPeakFrequency=function(){for(var t=-1/0,e=-1,i=this.freqToIndex(this.coder.freqMin);i<this.freqs.length;i++)this.freqs[i]>t&&(t=this.freqs[i],e=i);return t>this.peakThreshold?this.indexToFreq(e):null},r.prototype.loop=function(){this.analyser.getFloatFrequencyData(this.freqs),(this.iteration+1)%300==0&&this.restartServerIfSanityCheckFails();var t=this.getPeakFrequency();if(t){var e=this.coder.freqToChar(t);this.debug&&console.log("Transcribed char: "+e),this.peakHistory.add(e),this.peakTimes.add(new Date)}else{var i=this.peakTimes.last();i&&new Date-i>this.timeout&&(this.state=a.IDLE,this.debug&&console.log("Token",this.buffer,"timed out"),this.peakTimes.clear())}this.analysePeaks(),this.debug&&this.debugDraw_(),this.isRunning&&this.raf_(this.loop.bind(this)),this.iteration+=1},r.prototype.indexToFreq=function(t){return n.sampleRate/2/this.freqs.length*t},r.prototype.freqToIndex=function(t){var e=n.sampleRate/2;return Math.round(t/e*this.freqs.length)},r.prototype.analysePeaks=function(){var t=this.getLastRun();t&&(this.state==a.IDLE?t==this.coder.startChar&&(this.buffer="",this.state=a.RECV):this.state==a.RECV&&(t!=this.lastChar&&t!=this.coder.startChar&&t!=this.coder.endChar&&(this.buffer+=t,this.lastChar=t,this.fire_(this.callbacks.character,t)),t==this.coder.endChar&&(this.state=a.IDLE,this.fire_(this.callbacks.message,this.buffer),this.buffer="")))},r.prototype.getLastRun=function(){for(var t=this.peakHistory.last(),e=0,i=this.peakHistory.length()-2;i>=0;i--){if(this.peakHistory.get(i)!=t)break;e+=1}return e>this.minRunLength?(this.peakHistory.remove(i+1,e+1),t):null},r.prototype.debugDraw_=function(){var t=document.querySelector("canvas");t||(t=document.createElement("canvas"),document.body.appendChild(t)),t.width=document.body.offsetWidth,t.height=480,drawContext=t.getContext("2d");for(var e=0;e<this.freqs.length;e++){var i=this.freqs[e]+400,s=t.height-i-1,o=t.width/this.freqs.length;drawContext.fillStyle="black",drawContext.fillRect(e*o,s,1,1)}},r.prototype.raf_=function(t){!(!window.chrome||!chrome.extension)?setTimeout(t,1e3/60):requestAnimationFrame(t)},r.prototype.restartServerIfSanityCheckFails=function(){if(this.freqs[0]<-300)return console.error("freqs[0] < -300. Restarting."),void this.restart();for(var t=!0,e=0;e<10;e++)-100==this.freqs[e]&&(t=!1);t||(console.error("freqs[0:10] == -100. Restarting."),this.restart())},r.prototype.restart=function(){window.location.reload()},t.exports=r},2667:(t,e,i)=>{var s=i(687),o=new window.AudioContext||new webkitAudioContext;function n(t){t=t||{},this.coder=t.coder||new s,this.charDuration=t.charDuration||.2,this.coder=t.coder||new s(t),this.rampDuration=t.rampDuration||.001}n.prototype.send=function(t,e){t=this.coder.startChar+t+this.coder.endChar;for(var i=0;i<t.length;i++){var s=t[i],n=this.coder.charToFreq(s),r=o.currentTime+this.charDuration*i;this.scheduleToneAt(n,r,this.charDuration)}if(e){var a=this.charDuration*t.length;setTimeout(e,1e3*a)}},n.prototype.scheduleToneAt=function(t,e,i){var s=o.createGain();s.gain.value=0,s.gain.setValueAtTime(0,e),s.gain.linearRampToValueAtTime(1,e+this.rampDuration),s.gain.setValueAtTime(1,e+i-this.rampDuration),s.gain.linearRampToValueAtTime(0,e+i),s.connect(o.destination);var n=o.createOscillator();n.frequency.value=t,n.connect(s),n.start(e)},t.exports=n}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return i[t](n,n.exports,o),n.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var n=Object.create(null);o.r(n);var r={};t=t||[null,e({}),e([]),e(e)];for(var a=2&s&&i;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>r[t]=()=>i[t]));return r.default=()=>i,o.d(n,r),n},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=o(1793);function e(t){return t[Math.floor(Math.random()*t.length)]}const i=100,s=["#F44236","#E91D62","#9C26B0","#3E50B4","#2095F2","#8BC24A","#CCDB38","#FF5521"],n=function(t,e,i){if(void 0===e&&(e=t,t=0),void 0===i&&(i=1),i>0&&t>=e||i<0&&t<=e)return[];const s=[];for(let o=t;i>0?o<e:o>e;o+=i)s.push(o);return s}(50,150,25),r={alphabet:"abcdefghijklmnop",freqError:100},a=Object.assign({},r),m=Object.assign({},r),h=r.alphabet.substring(0,s.length),c=r.alphabet.substring(s.length,s.length+n.length),_=s.length+n.length,l=_+2,u=r.alphabet.substring(_,l);if(l>r.alphabet.length)throw new Error("too small sonic alphabet, more characters required: "+l);class p{constructor(t,e,i){this.position=t,this.radius=e,this.color=i}isWithin(t){return this.position.clone().sub(t).length()<=this.radius}}class d{constructor(t,e,i){this.world=t,this.body=t.addBall(e),this.ball=e,this.view=i}draw(){this.view.draw(this.ball.position)}isWithin(t){return this.ball.isWithin(t)}destroy(){return this.world.destroyBody(this.body),this.ball}shake(){const e=1e3*Math.random()-500,i=1e3*Math.random()-500;this.body.setAwake(!0),this.body.applyLinearImpulse(new t.Vec2(e,i),new t.Vec2(0,0))}}class y{constructor(t,e,i){this.context=t,this.color=e,this.radius=i}draw(t){const e=this.context;e.beginPath(),e.lineWidth=4,e.fillStyle=this.color,e.arc(t.x,-t.y,this.radius,0,2*Math.PI),e.fill(),e.stroke()}}const f=new Map(s.map(((t,e)=>[t,e]))),v=new Map(n.map(((t,e)=>[t,e])));var x=function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{m(s.next(t))}catch(t){n(t)}}function a(t){try{m(s.throw(t))}catch(t){n(t)}}function m(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}m((s=s.apply(t,e||[])).next())}))};class A{constructor(){this.socket=null,this.queue=Promise.resolve(),Promise.resolve().then(o.t.bind(o,2667,23)).then((t=>{this.socket=new t.default(m)}))}send(t){return x(this,void 0,void 0,(function*(){return new Promise((e=>{this.socket?this.socket.send(t,(()=>{e(),console.log("Sonic sent:",t)})):e()}))}))}sendToQueue(t){this.queue=this.queue.then((()=>this.send(t)))}sendBall(t){const e=function(t){return h[f.get(t.color)]+c[v.get(t.radius)]}(t);this.sendToQueue(e)}sendShake(){this.sendToQueue(u)}}class g{constructor(t){this.service=t}start(){Promise.resolve().then(o.t.bind(o,9044,23)).then((e=>{const i=new e.default(a);i.start(),i.on("message",(e=>{if(console.log("Sonic get:",e),e==u)return void this.service.shake();const i=function(e){if(e.length<2)return null;const i=h.indexOf(e[0]);if(i<0||i>=s.length)return null;const o=c.indexOf(e[1]);return o<0||o>=n.length?null:new p(new t.Vec2(0,0),n[o],s[i])}(e);null!==i?this.service.putBallAtRandomPosition(i):console.error("Can't  parse ball. Broken message:",e)}))}))}}const b=document.getElementById("canvas"),B=b.getContext("2d"),w=new class{constructor(e,i){this.groundBody=null,this.canvasWidth=e,this.canvasHeight=i,this.world=new t.World((0,t.Vec2)(0,-10)),this.createGround()}resetSize(t,e){this.groundBody&&(this.destroyBody(this.groundBody),this.groundBody=null),this.canvasWidth=t,this.canvasHeight=e,this.createGround()}createGround(){const e={density:0,friction:0},s=this.world.createBody();s.createFixture((0,t.Edge)((0,t.Vec2)(0,0),(0,t.Vec2)(this.canvasWidth/i,0)),e),s.createFixture((0,t.Edge)((0,t.Vec2)(0,-this.canvasHeight/i),(0,t.Vec2)(this.canvasWidth/i,-this.canvasHeight/i)),e),s.createFixture((0,t.Edge)((0,t.Vec2)(0,0),(0,t.Vec2)(0,-this.canvasHeight/i)),e),s.createFixture((0,t.Edge)((0,t.Vec2)(this.canvasWidth/i,0),(0,t.Vec2)(this.canvasWidth/i,-this.canvasHeight/i)),e),this.groundBody=s}addBall(e){const s=this.world.createDynamicBody();return s.createFixture((0,t.Circle)(e.radius/i),{density:10,friction:.1,restitution:.5}),s.setPosition(e.position.clone().mul(.01)),s.setUserData(e),s}step(t){this.world.step(t);let e=this.world.getBodyList();for(;null!=e;){const t=e.getUserData();null!=t&&(t.position=e.getPosition().clone().mul(i)),e=e.getNext()}}destroyBody(t){return this.world.destroyBody(t)}}(b.width,b.height),S=new class{constructor(t,e){this.ballPresenters=[],this.canvasWidth=0,this.canvasHeight=0,this.context=t,this.world=e}createBallAtPosition(t){const i=e(n),o=new p(t,i,e(s));this.addBall(o)}putBallAtRandomPosition(e){var i,s;e.position=new t.Vec2((i=e.radius,s=this.canvasWidth-e.radius,i+Math.random()*(s-i)),-e.radius),this.addBall(e)}addBall(t){this.ballPresenters.push(new d(this.world,t,new y(this.context,t.color,t.radius)))}popBall(t){for(let e=0;e<this.ballPresenters.length;++e){const i=this.ballPresenters[e];if(i.isWithin(t)){const t=i.destroy();return this.ballPresenters.splice(e,1),void(this.sonicClient&&this.sonicClient.sendBall(t))}}}drawBalls(){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ballPresenters.forEach((t=>t.draw()))}resetSize(t,e){this.canvasWidth=t,this.canvasHeight=e,this.world.resetSize(t,e)}step(t){this.world.step(t)}shake(){for(let t of this.ballPresenters)t.shake()}sendShake(){this.sonicClient&&this.sonicClient.sendShake()}clear(){for(let t of this.ballPresenters)t.destroy();this.ballPresenters.length=0}}(B,w),C=new class{constructor(t){this.service=t}startServer(){this.server?console.error("server already started"):(this.server=new g(this.service),this.server.start(),console.log("server started"))}startClient(){this.service.sonicClient?console.error("client already started"):(this.service.sonicClient=new A,console.log("client started"))}step(t){const e=Date.now();this.service.step((e-t)/1e3),this.service.drawBalls(),requestAnimationFrame((()=>this.step(e)))}run(){this.step(Date.now())}}(S);function M(){const t=window.innerWidth,e=window.innerHeight;b.width=t,b.height=e,S.resetSize(t,e)}window.addEventListener("resize",M,!1),M(),C.run(),b.onclick=function(e){S.createBallAtPosition(new t.Vec2(e.pageX,-e.pageY))},b.oncontextmenu=function(e){return e.preventDefault(),S.popBall(new t.Vec2(e.pageX,-e.pageY)),!1},document.addEventListener("keydown",(function(t){switch(t.key){case"c":C.startClient();break;case"p":S.clear();break;case"s":C.startServer();break;case"Enter":S.sendShake()}}),!1)})()})();